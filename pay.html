<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡è¨‚é–± - PayPal æ”¯ä»˜ç³»çµ±</title>
    <!-- å‹•æ…‹åŠ è¼‰ PayPal SDK -->
    <script>
        // é…ç½® - åœ¨é€™è£¡è¨­ç½®ä½ çš„ PayPal æ†‘è­‰
        const PAYPAL_CONFIG = {
            sandbox: {
                clientId: 'ASK8RjfrdCzGvCQRDvnfa321S_5OBGMK4KDGac5PreKf6NU-0d0MUPPrYe_S-fq4tcoHN22P8Nz4xZs3',  // æ›¿æ›ç‚ºä½ çš„ Sandbox Client ID
                secret: 'EB1-tdfv74XcCxkdDWjueV19ePB4Wf8uMKwdhE2robSWQF21i6nC6pm57zzVARTzJ03ah6X4ARc1GhBQ',       // æ›¿æ›ç‚ºä½ çš„ Sandbox Secret
                environment: 'sandbox'
            },
            live: {
                clientId: 'AZsh7JUNnTOO2eYLuwhfwMltWUUCcDS--qf2TzNVDCvlDK20lhbUrbRXYfZgfJEaDskmPi5nmssIQWme',     // æ›¿æ›ç‚ºä½ çš„ Live Client ID
                secret: 'ELlPg1idvYkNyzL1nBip5r2qL-fLBhHUpuz_aFQUD6OC7D1AlYj7qxPislk8_0igdkcp0afgPw2O5K0a',          // æ›¿æ›ç‚ºä½ çš„ Live Secret
                environment: 'production'
            }
        };
        
        // å…¨å±€é…ç½®
        let currentEnv = 'sandbox';
        let useAuthorize = true;
        let accessToken = null;
        
        // å‹•æ…‹åŠ è¼‰ PayPal SDK
        function loadPayPalSDK() {
            const script = document.createElement('script');
            const clientId = PAYPAL_CONFIG[currentEnv].clientId;
            const intent = useAuthorize ? 'authorize' : 'capture';
            
            script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}&currency=HKD&intent=${intent}&vault=true`;
            script.async = true;
            
            script.onload = () => {
                console.log('âœ… PayPal SDK åŠ è¼‰æˆåŠŸ');
                initPayPalButtons();
            };
            
            script.onerror = () => {
                console.error('âŒ PayPal SDK åŠ è¼‰å¤±æ•—');
                showError('ç„¡æ³•åŠ è¼‰ PayPal æœå‹™');
            };
            
            document.head.appendChild(script);
        }
        
        // é é¢åŠ è¼‰æ™‚åŸ·è¡Œ
        window.onload = function() {
            loadPayPalSDK();
            setupEventListeners();
            showTestCredentials();
        };
    </script>
    <style>
        :root {
            --primary: #003087;
            --secondary: #009cde;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        /* æœƒå“¡æ–¹æ¡ˆå¡ç‰‡ */
        .plans-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .plan-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--secondary);
        }
        
        .plan-card.popular {
            border-color: var(--secondary);
            transform: scale(1.02);
        }
        
        .plan-card.popular::before {
            content: 'ç†±é–€é¸æ“‡';
            position: absolute;
            top: 15px;
            right: -30px;
            background: var(--secondary);
            color: white;
            padding: 5px 30px;
            transform: rotate(45deg);
            font-size: 12px;
            font-weight: bold;
        }
        
        .plan-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }
        
        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .plan-price {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        
        .plan-price span {
            font-size: 1.2rem;
            color: var(--dark);
            font-weight: 400;
        }
        
        .plan-period {
            color: #666;
            font-size: 0.9rem;
        }
        
        .plan-features {
            list-style: none;
            margin-bottom: 25px;
            min-height: 200px;
        }
        
        .plan-features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
        }
        
        .plan-features li::before {
            content: 'âœ“';
            color: var(--success);
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.1rem;
        }
        
        .select-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .select-btn:hover {
            background: #002366;
            transform: translateY(-2px);
        }
        
        .select-btn i {
            font-size: 1.2rem;
        }
        
        /* æ”¯ä»˜é¢æ¿ */
        .payment-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
        }
        
        .selected-plan-info {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary);
        }
        
        .selected-plan-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .selected-plan-info p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .payment-details {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .detail-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        /* PayPal æŒ‰éˆ•å®¹å™¨ */
        #paypal-button-container {
            margin: 25px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æ”¯ä»˜çµæœ */
        .result-container {
            display: none;
            margin-top: 25px;
            padding: 25px;
            border-radius: 10px;
            animation: fadeIn 0.5s ease;
        }
        
        .result-container.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            display: block;
        }
        
        .result-container.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            display: block;
        }
        
        .result-container.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            display: block;
        }
        
        .result-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* åŠ è¼‰é®ç½© */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .control-content {
            display: none;
        }
        
        .control-content.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .env-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .env-btn {
            padding: 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .env-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .mode-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .mode-selector input[type="radio"] {
            transform: scale(1.2);
        }
        
        .info-box {
            background: #e8f4f8;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary);
        }
        
        .info-box h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .info-box ul {
            padding-left: 20px;
        }
        
        .info-box li {
            margin-bottom: 8px;
            color: #555;
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .plans-grid {
                grid-template-columns: 1fr;
            }
            
            .plan-card.popular {
                transform: none;
            }
            
            .plan-card.popular::before {
                top: 10px;
                right: -25px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ å°ˆæ¥­æœƒå“¡è¨‚é–±æœå‹™</h1>
            <p>é¸æ“‡é©åˆæ‚¨çš„æ–¹æ¡ˆï¼Œé–‹å•Ÿå°ˆå±¬æœƒå“¡é«”é©—</p>
        </header>
        
        <div class="content">
            <!-- å·¦å´ï¼šæœƒå“¡æ–¹æ¡ˆé¸æ“‡ -->
            <div class="plans-section">
                <h2 class="section-title">ğŸ“‹ é¸æ“‡æœƒå“¡æ–¹æ¡ˆ</h2>
                
                <div class="plans-grid">
                    <!-- åŸºæœ¬æœƒå“¡æ–¹æ¡ˆ -->
                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-name">åŸºæœ¬æœƒå“¡</div>
                            <div class="plan-price">HK$99<span>/æœˆ</span></div>
                            <div class="plan-period">æ¯æœˆè‡ªå‹•çºŒè¨‚</div>
                        </div>
                        <ul class="plan-features">
                            <li>å®Œæ•´å…§å®¹å­˜å–æ¬Šé™</li>
                            <li>æ¨™æº–å®¢æˆ¶æ”¯æ´</li>
                            <li>æ¯æœˆ100å€‹ä½¿ç”¨é»æ•¸</li>
                            <li>åŸºç¤æ•¸æ“šåˆ†æ</li>
                            <li>Email æŠ€è¡“æ”¯æ´</li>
                            <li>ç¤¾ç¾¤è¨è«–å€å­˜å–</li>
                        </ul>
                        <button class="select-btn" onclick="selectPlan('basic', 99, 'åŸºæœ¬æœƒå“¡')">
                            <i>âœ“</i> é¸æ“‡æ­¤æ–¹æ¡ˆ
                        </button>
                    </div>
                    
                    <!-- å°ˆæ¥­æœƒå“¡æ–¹æ¡ˆï¼ˆç†±é–€ï¼‰ -->
                    <div class="plan-card popular">
                        <div class="plan-header">
                            <div class="plan-name">å°ˆæ¥­æœƒå“¡</div>
                            <div class="plan-price">HK$199<span>/æœˆ</span></div>
                            <div class="plan-period">æ¯æœˆè‡ªå‹•çºŒè¨‚</div>
                        </div>
                        <ul class="plan-features">
                            <li>æ‰€æœ‰é€²éšåŠŸèƒ½å­˜å–</li>
                            <li>å„ªå…ˆå®¢æˆ¶æ”¯æ´</li>
                            <li>ç„¡é™ä½¿ç”¨é»æ•¸</li>
                            <li>é€²éšæ•¸æ“šåˆ†æ</li>
                            <li>å°ˆå±¬å®¢æœç¶“ç†</li>
                            <li>API å­˜å–æ¬Šé™</li>
                            <li>å®¢è£½åŒ–å ±å‘Š</li>
                            <li>å®šæœŸåŸ¹è¨“èª²ç¨‹</li>
                        </ul>
                        <button class="select-btn" onclick="selectPlan('pro', 199, 'å°ˆæ¥­æœƒå“¡')">
                            <i>ğŸš€</i> é¸æ“‡æ­¤æ–¹æ¡ˆ
                        </button>
                    </div>
                    
                    <!-- ä¼æ¥­æœƒå“¡æ–¹æ¡ˆ -->
                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-name">ä¼æ¥­æœƒå“¡</div>
                            <div class="plan-price">HK$499<span>/æœˆ</span></div>
                            <div class="plan-period">æ¯æœˆè‡ªå‹•çºŒè¨‚</div>
                        </div>
                        <ul class="plan-features">
                            <li>æ‰€æœ‰å°ˆæ¥­ç‰ˆåŠŸèƒ½</li>
                            <li>å°ˆå±¬å®¢æˆ¶ç¶“ç†</li>
                            <li>åœ˜éšŠæˆå“¡å¸³è™Ÿï¼ˆ10å€‹ï¼‰</li>
                            <li>å®¢è£½åŒ–è§£æ±ºæ–¹æ¡ˆ</li>
                            <li>å®Œæ•´ API å­˜å–</li>
                            <li>ä¼æ¥­ç´šå®‰å…¨æ€§</li>
                            <li>å°ˆå±¬åŸ¹è¨“èª²ç¨‹</li>
                            <li>24/7 æŠ€è¡“æ”¯æ´</li>
                            <li>SLA æœå‹™ä¿è­‰</li>
                        </ul>
                        <button class="select-btn" onclick="selectPlan('enterprise', 499, 'ä¼æ¥­æœƒå“¡')">
                            <i>ğŸ¢</i> é¸æ“‡æ­¤æ–¹æ¡ˆ
                        </button>
                    </div>
                </div>
                
                <div class="info-box">
                    <h4>ğŸ’¡ è¨‚é–±èªªæ˜</h4>
                    <ul>
                        <li>æ‰€æœ‰æ–¹æ¡ˆå‡ç‚ºæ¯æœˆè‡ªå‹•çºŒè¨‚</li>
                        <li>å¯éš¨æ™‚å–æ¶ˆï¼Œå–æ¶ˆå¾Œæœå‹™æŒçºŒè‡³ç•¶æœŸçµæŸ</li>
                        <li>æ”¯æŒå¤šç¨®æ”¯ä»˜æ–¹å¼ï¼Œç”± PayPal å®‰å…¨è™•ç†</li>
                        <li>é¦–æ¬¡è¨‚é–±äº« 14 å¤©ç„¡æ¢ä»¶é€€æ¬¾ä¿è­‰</li>
                    </ul>
                </div>
            </div>
            
            <!-- å³å´ï¼šæ”¯ä»˜é¢æ¿ -->
            <div class="payment-panel">
                <div class="selected-plan-info" id="selectedPlanInfo" style="display: none;">
                    <h3 id="selectedPlanName">å°ˆæ¥­æœƒå“¡</h3>
                    <p id="selectedPlanPrice">HK$199/æœˆ</p>
                    <p id="selectedPlanId" style="font-size: 0.9rem; color: #888; margin-top: 5px;"></p>
                </div>
                
                <div class="payment-details" id="paymentDetails" style="display: none;">
                    <h4>è¨‚é–±è©³æƒ…</h4>
                    <div class="detail-row">
                        <span>æ–¹æ¡ˆåç¨±</span>
                        <span id="detailPlanName">-</span>
                    </div>
                    <div class="detail-row">
                        <span>æœˆè²»é‡‘é¡</span>
                        <span id="detailPrice">-</span>
                    </div>
                    <div class="detail-row">
                        <span>æ”¯ä»˜æ¨¡å¼</span>
                        <span id="detailMode">-</span>
                    </div>
                    <div class="detail-row">
                        <span>è¨‚é–±é€±æœŸ</span>
                        <span>æ¯æœˆè‡ªå‹•çºŒè¨‚</span>
                    </div>
                    <div class="detail-row">
                        <span>æ”¯ä»˜ç’°å¢ƒ</span>
                        <span id="detailEnv">-</span>
                    </div>
                    <div class="detail-row">
                        <span>ç¸½è¨ˆ</span>
                        <span id="detailTotal">-</span>
                    </div>
                </div>
                
                <!-- PayPal æŒ‰éˆ•å®¹å™¨ -->
                <div id="paypal-button-container">
                    <p style="color: #666; text-align: center;">è«‹å…ˆé¸æ“‡æœƒå“¡æ–¹æ¡ˆ</p>
                </div>
                
                <!-- æ”¯ä»˜çµæœé¡¯ç¤º -->
                <div id="paymentResult" class="result-container"></div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="control-header" onclick="toggleControlPanel()">
                <h3 style="color: var(--primary);">âš™ï¸ é–‹ç™¼è€…è¨­å®š</h3>
                <span id="controlToggleIcon">â–¼</span>
            </div>
            
            <div class="control-content" id="controlContent">
                <div class="env-selector">
                    <button class="env-btn active" onclick="setEnvironment('sandbox')">Sandbox æ¸¬è©¦</button>
                    <button class="env-btn" onclick="setEnvironment('live')">Live ç”Ÿç”¢</button>
                </div>
                
                <div class="mode-selector">
                    <label>
                        <input type="radio" name="paymentMode" value="authorize" checked onclick="setPaymentMode('authorize')">
                        é æˆæ¬Šæ¨¡å¼ (Authorize)
                    </label>
                    <label>
                        <input type="radio" name="paymentMode" value="capture" onclick="setPaymentMode('capture')">
                        ç«‹å³æ”¶æ¬¾æ¨¡å¼ (Capture)
                    </label>
                </div>
                
                <div class="info-box">
                    <h4>ğŸ” å®‰å…¨èªªæ˜</h4>
                    <ul>
                        <li><strong>é æˆæ¬Šæ¨¡å¼</strong>: å…ˆæˆæ¬Šæ”¯ä»˜ï¼Œç¨å¾Œå†è«‹æ¬¾ï¼ˆé©åˆè¨‚é–±æœå‹™ï¼‰</li>
                        <li><strong>ç«‹å³æ”¶æ¬¾æ¨¡å¼</strong>: ç›´æ¥å®Œæˆæ”¯ä»˜ä¸¦è«‹æ¬¾</li>
                        <li><strong>Sandbox</strong>: æ¸¬è©¦ç’°å¢ƒï¼Œä½¿ç”¨æ¸¬è©¦è³¬æˆ¶å’Œä¿¡ç”¨å¡</li>
                        <li><strong>Live</strong>: ç”Ÿç”¢ç’°å¢ƒï¼ŒçœŸå¯¦äº¤æ˜“</li>
                    </ul>
                </div>
                
                <div id="testCredentials" style="display: none; margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
                    <h4 style="color: #856404;">ğŸ§ª æ¸¬è©¦æ†‘è­‰</h4>
                    <p style="color: #856404; margin: 10px 0;">è«‹å°‡ä»¥ä¸‹æ†‘è­‰æ›¿æ›ç‚ºä½ è‡ªå·±çš„ï¼š</p>
                    <div style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9rem;">
                        <div>Sandbox Client ID: <span style="color: var(--primary);">YOUR_SANDBOX_CLIENT_ID</span></div>
                        <div>Sandbox Secret: <span style="color: var(--primary);">YOUR_SANDBOX_SECRET</span></div>
                        <div>Live Client ID: <span style="color: var(--primary);">YOUR_LIVE_CLIENT_ID</span></div>
                        <div>Live Secret: <span style="color: var(--primary);">YOUR_LIVE_SECRET</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åŠ è¼‰é®ç½© -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3 id="loadingMessage">è™•ç†ä¸­...</h3>
            <p id="loadingSubtext" style="color: #666; margin-top: 10px;"></p>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let selectedPlan = null;
        let selectedPlanPrice = 0;
        let selectedPlanName = '';
        let paypalButtons = null;
        
        // é¡¯ç¤º/éš±è—åŠ è¼‰é®ç½©
        function showLoading(message = 'è™•ç†ä¸­...', subtext = '') {
            document.getElementById('loadingMessage').textContent = message;
            document.getElementById('loadingSubtext').textContent = subtext;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // é¡¯ç¤ºæ”¯ä»˜çµæœ
        function showPaymentResult(message, type = 'info') {
            const resultDiv = document.getElementById('paymentResult');
            resultDiv.className = `result-container ${type}`;
            resultDiv.innerHTML = message;
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // é¡¯ç¤ºéŒ¯èª¤
        function showError(message) {
            showPaymentResult(`
                <div class="result-icon">âŒ</div>
                <h3>æ“ä½œå¤±æ•—</h3>
                <p>${message}</p>
                <button class="select-btn" onclick="retryPayment()" style="margin-top: 15px; background: var(--danger);">
                    é‡è©¦
                </button>
            `, 'error');
        }
        
        // é¸æ“‡æœƒå“¡æ–¹æ¡ˆ
        function selectPlan(planId, price, planName) {
            selectedPlan = planId;
            selectedPlanPrice = price;
            selectedPlanName = planName;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('selectedPlanInfo').style.display = 'block';
            document.getElementById('selectedPlanName').textContent = planName;
            document.getElementById('selectedPlanPrice').textContent = `HK$${price}/æœˆ`;
            document.getElementById('selectedPlanId').textContent = `æ–¹æ¡ˆä»£ç¢¼: ${planId}`;
            
            // æ›´æ–°æ”¯ä»˜è©³æƒ…
            updatePaymentDetails();
            
            // é‡æ–°åˆå§‹åŒ– PayPal æŒ‰éˆ•
            initPayPalButtons();
            
            console.log(`ğŸ“ å·²é¸æ“‡æ–¹æ¡ˆ: ${planName}, åƒ¹æ ¼: HK$${price}`);
        }
        
        // æ›´æ–°æ”¯ä»˜è©³æƒ…
        function updatePaymentDetails() {
            if (!selectedPlan) return;
            
            document.getElementById('paymentDetails').style.display = 'block';
            
            document.getElementById('detailPlanName').textContent = selectedPlanName;
            document.getElementById('detailPrice').textContent = `HK$${selectedPlanPrice}.00`;
            document.getElementById('detailMode').textContent = useAuthorize ? 'é æˆæ¬Š (Authorize)' : 'ç«‹å³æ”¶æ¬¾ (Capture)';
            document.getElementById('detailEnv').textContent = currentEnv === 'sandbox' ? 'æ¸¬è©¦ç’°å¢ƒ' : 'ç”Ÿç”¢ç’°å¢ƒ';
            document.getElementById('detailTotal').textContent = `HK$${selectedPlanPrice}.00/æœˆ`;
        }
        
        // åˆå§‹åŒ– PayPal æŒ‰éˆ•
        function initPayPalButtons() {
            if (!selectedPlan) {
                document.getElementById('paypal-button-container').innerHTML = 
                    '<p style="color: #666; text-align: center;">è«‹å…ˆé¸æ“‡æœƒå“¡æ–¹æ¡ˆ</p>';
                return;
            }
            
            if (!window.paypal) {
                console.error('PayPal SDK æœªåŠ è¼‰');
                document.getElementById('paypal-button-container').innerHTML = 
                    '<p style="color: #dc3545; text-align: center;">PayPal æœå‹™åŠ è¼‰ä¸­...</p>';
                return;
            }
            
            const container = document.getElementById('paypal-button-container');
            container.innerHTML = '<p style="color: #666; text-align: center;">æ­£åœ¨åˆå§‹åŒ– PayPal...</p>';
            
            try {
                // å¦‚æœå·²æœ‰æŒ‰éˆ•ï¼Œå…ˆæ¸…ç†
                if (paypalButtons) {
                    paypalButtons.close();
                }
                
                // å‰µå»ºæ–°çš„ PayPal æŒ‰éˆ•
                paypalButtons = paypal.Buttons({
                    style: {
                        layout: 'vertical',
                        color: 'blue',
                        shape: 'rect',
                        label: 'paypal',
                        height: 55,
                        tagline: false
                    },
                    
                    // å‰µå»ºè¨‚å–®
                    createOrder: function(data, actions) {
                        const orderData = {
                            intent: useAuthorize ? 'AUTHORIZE' : 'CAPTURE',
                            purchase_units: [{
                                reference_id: `MEMBERSHIP_${selectedPlan}_${Date.now()}`,
                                description: `${selectedPlanName} æœƒå“¡è¨‚é–±`,
                                custom_id: selectedPlan,
                                invoice_id: `INV-${Date.now()}`,
                                amount: {
                                    value: selectedPlanPrice.toFixed(2),
                                    currency_code: 'HKD',
                                    breakdown: {
                                        item_total: {
                                            currency_code: 'HKD',
                                            value: selectedPlanPrice.toFixed(2)
                                        }
                                    }
                                },
                                items: [{
                                    name: selectedPlanName,
                                    description: 'æ¯æœˆè‡ªå‹•çºŒè¨‚æœå‹™',
                                    quantity: '1',
                                    unit_amount: {
                                        currency_code: 'HKD',
                                        value: selectedPlanPrice.toFixed(2)
                                    },
                                    category: 'DIGITAL_GOODS'
                                }]
                            }],
                            application_context: {
                                brand_name: 'æœƒå“¡è¨‚é–±æœå‹™',
                                locale: 'zh-HK',
                                landing_page: 'BILLING',
                                user_action: 'SUBSCRIBE_NOW',
                                payment_method: {
                                    payer_selected: 'PAYPAL',
                                    payee_preferred: 'IMMEDIATE_PAYMENT_REQUIRED'
                                },
                                shipping_preference: 'NO_SHIPPING'
                            }
                        };
                        
                        console.log('ğŸ“¦ å‰µå»ºè¨‚å–®:', orderData);
                        return actions.order.create(orderData);
                    },
                    
                    // æ‰¹å‡†è¨‚å–®
                    onApprove: async function(data, actions) {
                        showLoading('æ­£åœ¨è™•ç† PayPal æ”¯ä»˜...', 'è«‹å‹¿é—œé–‰é é¢');
                        
                        try {
                            let result;
                            
                            if (useAuthorize) {
                                // Authorize æ¨¡å¼ï¼šå…ˆæˆæ¬Š
                                console.log('ğŸ”’ åŸ·è¡Œæˆæ¬Š...');
                                result = await actions.order.authorize();
                                
                                // é€™è£¡æ‡‰è©²ç™¼é€åˆ°ä½ çš„æœå‹™å™¨è™•ç†æˆæ¬Š
                                await handleAuthorizedPayment(result);
                            } else {
                                // Capture æ¨¡å¼ï¼šç›´æ¥è«‹æ¬¾
                                console.log('ğŸ’° åŸ·è¡Œè«‹æ¬¾...');
                                result = await actions.order.capture();
                                
                                // é€™è£¡æ‡‰è©²ç™¼é€åˆ°ä½ çš„æœå‹™å™¨è™•ç†
                                await handleCapturedPayment(result);
                            }
                            
                        } catch (error) {
                            hideLoading();
                            console.error('æ”¯ä»˜è™•ç†éŒ¯èª¤:', error);
                            showError(`æ”¯ä»˜å¤±æ•—: ${error.message}`);
                        }
                    },
                    
                    // è™•ç†éŒ¯èª¤
                    onError: function(err) {
                        console.error('PayPal æŒ‰éˆ•éŒ¯èª¤:', err);
                        showError(`æ”¯ä»˜éŒ¯èª¤: ${err.message}`);
                    },
                    
                    // å–æ¶ˆæ”¯ä»˜
                    onCancel: function(data) {
                        console.log('ç”¨æˆ¶å–æ¶ˆäº†æ”¯ä»˜');
                        showPaymentResult(`
                            <div class="result-icon">â„¹ï¸</div>
                            <h3>æ”¯ä»˜å·²å–æ¶ˆ</h3>
                            <p>æ‚¨å¯ä»¥éš¨æ™‚é‡æ–°é¸æ“‡æ–¹æ¡ˆé€²è¡Œæ”¯ä»˜</p>
                        `, 'info');
                    }
                });
                
                // æ¸²æŸ“æŒ‰éˆ•
                if (paypalButtons.isEligible()) {
                    container.innerHTML = '';
                    paypalButtons.render('#paypal-button-container');
                    console.log('âœ… PayPal æŒ‰éˆ•åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="color: #dc3545; margin-bottom: 15px;">PayPal æ”¯ä»˜æš«ä¸å¯ç”¨</p>
                            <button class="select-btn" onclick="retryPayPal()" style="max-width: 200px;">
                                é‡è©¦
                            </button>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('åˆå§‹åŒ– PayPal æŒ‰éˆ•éŒ¯èª¤:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p style="color: #dc3545; margin-bottom: 15px;">PayPal åˆå§‹åŒ–å¤±æ•—</p>
                        <button class="select-btn" onclick="retryPayPal()" style="max-width: 200px;">
                            é‡æ–°åŠ è¼‰
                        </button>
                    </div>
                `;
            }
        }
        
        // è™•ç†æˆæ¬Šæ”¯ä»˜
        async function handleAuthorizedPayment(authorization) {
            try {
                const authId = authorization.purchase_units[0].payments.authorizations[0].id;
                const authAmount = authorization.purchase_units[0].payments.authorizations[0].amount.value;
                
                // æ¨¡æ“¬æœå‹™å™¨è™•ç†ï¼ˆå¯¦éš›æ‡‰ç™¼é€åˆ°ä½ çš„æœå‹™å™¨ï¼‰
                await simulateServerProcessing();
                
                hideLoading();
                
                showPaymentResult(`
                    <div class="result-icon">ğŸ”’</div>
                    <h3>é æˆæ¬ŠæˆåŠŸï¼</h3>
                    <p>æ‚¨çš„ ${selectedPlanName} æœƒå“¡è¨‚é–±å·²å•Ÿå‹•</p>
                    
                    <div style="margin-top: 20px; background: white; padding: 15px; border-radius: 8px;">
                        <h4>ğŸ“‹ äº¤æ˜“è©³æƒ…</h4>
                        <div class="detail-row">
                            <span>æˆæ¬Šç·¨è™Ÿ</span>
                            <span style="font-family: monospace; font-size: 0.9rem;">${authId.substring(0, 20)}...</span>
                        </div>
                        <div class="detail-row">
                            <span>è¨‚é–±æ–¹æ¡ˆ</span>
                            <span>${selectedPlanName}</span>
                        </div>
                        <div class="detail-row">
                            <span>æˆæ¬Šé‡‘é¡</span>
                            <span>HK$${authAmount}</span>
                        </div>
                        <div class="detail-row">
                            <span>æˆæ¬Šç‹€æ…‹</span>
                            <span style="color: #ff9800; font-weight: bold;">å·²é æˆæ¬Š</span>
                        </div>
                        <div class="detail-row">
                            <span>æˆæ¬Šæ™‚é–“</span>
                            <span>${new Date().toLocaleString('zh-HK')}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                        <h4 style="color: #856404;">ğŸ’¡ é‡è¦æç¤º</h4>
                        <p style="color: #856404; margin: 10px 0;">
                            æ¬¾é …å·²é ç•™ï¼Œè«‹åœ¨24å°æ™‚å…§åˆ° PayPal å¾Œå°å®Œæˆè«‹æ¬¾æ“ä½œã€‚
                            å¦‚éœ€å¹«åŠ©ï¼Œè«‹è¯ç¹«å®¢æœã€‚
                        </p>
                    </div>
                `, 'success');
                
                console.log('ğŸ‰ æˆæ¬Šè™•ç†å®Œæˆ:', authorization);
                
            } catch (error) {
                hideLoading();
                throw error;
            }
        }
        
        // è™•ç†æ•ç²æ”¯ä»˜
        async function handleCapturedPayment(capture) {
            try {
                const captureId = capture.purchase_units[0].payments.captures[0].id;
                const captureAmount = capture.purchase_units[0].payments.captures[0].amount.value;
                
                // æ¨¡æ“¬æœå‹™å™¨è™•ç†
                await simulateServerProcessing();
                
                hideLoading();
                
                showPaymentResult(`
                    <div class="result-icon">ğŸ‰</div>
                    <h3>è¨‚é–±æˆåŠŸï¼</h3>
                    <p>æ‚¨çš„ ${selectedPlanName} æœƒå“¡è¨‚é–±å·²ç”Ÿæ•ˆ</p>
                    
                    <div style="margin-top: 20px; background: white; padding: 15px; border-radius: 8px;">
                        <h4>ğŸ“‹ äº¤æ˜“è©³æƒ…</h4>
                        <div class="detail-row">
                            <span>äº¤æ˜“ç·¨è™Ÿ</span>
                            <span style="font-family: monospace; font-size: 0.9rem;">${captureId.substring(0, 20)}...</span>
                        </div>
                        <div class="detail-row">
                            <span>è¨‚é–±æ–¹æ¡ˆ</span>
                            <span>${selectedPlanName}</span>
                        </div>
                        <div class="detail-row">
                            <span>æ”¯ä»˜é‡‘é¡</span>
                            <span>HK$${captureAmount}</span>
                        </div>
                        <div class="detail-row">
                            <span>æ”¯ä»˜ç‹€æ…‹</span>
                            <span style="color: #28a745; font-weight: bold;">å·²å®Œæˆ</span>
                        </div>
                        <div class="detail-row">
                            <span>å®Œæˆæ™‚é–“</span>
                            <span>${new Date().toLocaleString('zh-HK')}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 8px;">
                        <h4 style="color: #155724;">âœ¨ æ­¡è¿åŠ å…¥ï¼</h4>
                        <p style="color: #155724; margin: 10px 0;">
                            æ‚¨ç¾åœ¨å¯ä»¥é–‹å§‹ä½¿ç”¨æ‰€æœ‰æœƒå“¡åŠŸèƒ½ã€‚
                            å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹éš¨æ™‚è¯ç¹«å®¢æœã€‚
                        </p>
                    </div>
                `, 'success');
                
                console.log('ğŸ‰ æ”¯ä»˜è™•ç†å®Œæˆ:', capture);
                
            } catch (error) {
                hideLoading();
                throw error;
            }
        }
        
        // æ¨¡æ“¬æœå‹™å™¨è™•ç†
        async function simulateServerProcessing() {
            return new Promise(resolve => {
                setTimeout(() => {
                    console.log('âœ… æœå‹™å™¨è™•ç†å®Œæˆ');
                    resolve();
                }, 2000);
            });
        }
        
        // è¨­ç½®ç’°å¢ƒ
        function setEnvironment(env) {
            if (currentEnv === env) return;
            
            currentEnv = env;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.env-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // é‡æ–°åŠ è¼‰ PayPal SDK
            loadPayPalSDK();
            
            // æ›´æ–°é¡¯ç¤º
            updatePaymentDetails();
            
            console.log(`ğŸŒ åˆ‡æ›åˆ° ${env} ç’°å¢ƒ`);
        }
        
        // è¨­ç½®æ”¯ä»˜æ¨¡å¼
        function setPaymentMode(mode) {
            useAuthorize = (mode === 'authorize');
            
            // é‡æ–°åŠ è¼‰ PayPal SDK
            loadPayPalSDK();
            
            // æ›´æ–°é¡¯ç¤º
            updatePaymentDetails();
            
            console.log(`ğŸ’° åˆ‡æ›åˆ° ${mode} æ¨¡å¼`);
        }
        
        // é‡è©¦æ”¯ä»˜
        function retryPayment() {
            initPayPalButtons();
        }
        
        // é‡è©¦ PayPal
        function retryPayPal() {
            loadPayPalSDK();
        }
        
        // åˆ‡æ›æ§åˆ¶é¢æ¿
        function toggleControlPanel() {
            const content = document.getElementById('controlContent');
            const icon = document.getElementById('controlToggleIcon');
            
            content.classList.toggle('show');
            icon.textContent = content.classList.contains('show') ? 'â–²' : 'â–¼';
        }
        
        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // æ·»åŠ å…¶ä»–äº‹ä»¶ç›£è½å™¨
        }
        
        // é¡¯ç¤ºæ¸¬è©¦æ†‘è­‰æç¤º
        function showTestCredentials() {
            const sandboxId = PAYPAL_CONFIG.sandbox.clientId;
            const liveId = PAYPAL_CONFIG.live.clientId;
            
            if (sandboxId.includes('YOUR_') || liveId.includes('YOUR_')) {
                document.getElementById('testCredentials').style.display = 'block';
            }
        }
    </script>
</body>
</html>
