<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密百家樂 | Crypto Baccarat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00d09c;
            --secondary-color: #1db954;
            --spotify-green: #1db954;
            --soundcloud-orange: #ff8800;
            --danger-color: #ff4757;
            --warning-color: #ffa502;
            --dark-bg: #0f1525;
            --darker-bg: #0a0e1a;
            --card-bg: #1a2238;
            --text-color: #ffffff;
            --text-secondary: #8a94ad;
            --player-color: #3498db;
            --banker-color: #e74c3c;
            --tie-color: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }

        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: var(--primary-color);
        }

        .music-control {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .spotify-player {
            background: rgba(29, 185, 84, 0.1);
            border: 2px solid var(--spotify-green);
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .spotify-player:hover {
            background: rgba(29, 185, 84, 0.2);
            transform: translateY(-2px);
        }

        .soundcloud-player {
            background: rgba(255, 136, 0, 0.1);
            border: 2px solid var(--soundcloud-orange);
        }

        .soundcloud-player:hover {
            background: rgba(255, 136, 0, 0.2);
        }

        .spotify-icon {
            color: var(--spotify-green);
            font-size: 1.8rem;
        }

        .soundcloud-icon {
            color: var(--soundcloud-orange);
            font-size: 1.8rem;
        }

        .track-info {
            flex: 1;
            min-width: 0;
        }

        .track-title {
            font-weight: bold;
            color: var(--spotify-green);
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .soundcloud-player .track-title {
            color: var(--soundcloud-orange);
        }

        .track-artist {
            color: var(--text-secondary);
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .music-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .music-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .music-btn.active {
            background: var(--secondary-color);
            color: white;
        }

        .volume-slider {
            width: 80px;
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--secondary-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .balance-display {
            text-align: right;
        }

        .total-balance {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .deposit-btn {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deposit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 208, 156, 0.3);
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .game-table {
            background: linear-gradient(145deg, #1a2238, #141b2d);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .table-content {
            position: relative;
            z-index: 2;
        }

        .cards-container {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            gap: 50px;
        }

        .player-side, .banker-side {
            text-align: center;
            flex: 1;
            padding: 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.03);
        }

        .side-label {
            font-size: 1.8rem;
            margin-bottom: 30px;
            padding: 15px 40px;
            border-radius: 50px;
            display: inline-block;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            border: 3px solid;
        }

        .player-label {
            background: rgba(52, 152, 219, 0.1);
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-label {
            background: rgba(231, 76, 60, 0.1);
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            min-height: 180px;
            align-items: center;
        }

        .card {
            width: 120px;
            height: 170px;
            background: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            color: #1a2238;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-front {
            background: white;
            transform: rotateY(0deg);
        }

        .card-back {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transform: rotateY(180deg);
            color: white;
            font-size: 2rem;
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.placeholder {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .points-display {
            font-size: 2.8rem;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            display: inline-block;
            min-width: 200px;
            border: 3px solid;
        }

        .player-points {
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-points {
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .result-area {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .result-text {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .winner-player {
            color: var(--player-color);
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.7);
        }

        .winner-banker {
            color: var(--banker-color);
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
        }

        .winner-tie {
            color: var(--tie-color);
            text-shadow: 0 0 20px rgba(243, 156, 18, 0.7);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 30px;
        }

        .btn {
            padding: 18px 45px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 10px 25px rgba(0, 208, 156, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 208, 156, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .big-road-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .big-road-container h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .big-road {
            background: #0a0e1a;
            border-radius: 15px;
            padding: 15px;
            overflow-x: auto;
        }

        .road-grid {
            display: grid;
            grid-template-columns: repeat(40, 30px);
            grid-template-rows: repeat(6, 30px);
            gap: 2px;
            min-width: 1240px;
        }

        .road-cell {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            position: relative;
        }

        .player-road {
            background: transparent;
            border: 3px solid var(--player-color);
            color: var(--player-color);
        }

        .banker-road {
            background: transparent;
            border: 3px solid var(--banker-color);
            color: var(--banker-color);
        }

        .tie-road {
            background: var(--tie-color);
            border: 2px solid white;
            transform: rotate(45deg);
            width: 20px;
            height: 20px;
            margin: 5px;
        }

        .empty-road {
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .dragon-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: currentColor;
            color: white;
            font-size: 10px;
            font-weight: bold;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .betting-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .betting-panel h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bet-amount-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .bet-amount-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .bet-target-display {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .target-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }

        .target-btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .target-btn[data-target="player"].active {
            background: rgba(52, 152, 219, 0.2);
            color: var(--player-color);
            border: 2px solid var(--player-color);
        }

        .target-btn[data-target="banker"].active {
            background: rgba(231, 76, 60, 0.2);
            color: var(--banker-color);
            border: 2px solid var(--banker-color);
        }

        .target-btn[data-target="tie"].active {
            background: rgba(243, 156, 18, 0.2);
            color: var(--tie-color);
            border: 2px solid var(--tie-color);
        }

        .amount-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .amount-btn {
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .amount-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
        }

        .custom-amount {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .custom-amount input {
            flex: 1;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
            text-align: center;
        }

        .custom-amount button {
            padding: 0 25px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .bet-actions {
            display: flex;
            gap: 12px;
        }

        .bet-actions button {
            flex: 1;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .btn-clear {
            background: rgba(255, 71, 87, 0.1);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .btn-clear:hover {
            background: rgba(255, 71, 87, 0.2);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-panel h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .history-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 350px;
            overflow-y: auto;
        }

        .history-panel h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            padding: 10px 0;
            z-index: 1;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border-left: 4px solid;
        }

        .history-player {
            border-left-color: var(--player-color);
        }

        .history-banker {
            border-left-color: var(--banker-color);
        }

        .history-tie {
            border-left-color: var(--tie-color);
        }

        /* 音樂模態框樣式 */
        .music-modal .modal-content {
            max-width: 800px;
            width: 90%;
        }

        .music-platform-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .platform-option {
            flex: 1;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .platform-option.active {
            transform: translateY(-5px);
        }

        .platform-option[data-platform="spotify"].active {
            background: rgba(29, 185, 84, 0.1);
            border-color: var(--spotify-green);
        }

        .platform-option[data-platform="soundcloud"].active {
            background: rgba(255, 136, 0, 0.1);
            border-color: var(--soundcloud-orange);
        }

        .platform-option[data-platform="custom"].active {
            background: rgba(0, 208, 156, 0.1);
            border-color: var(--primary-color);
        }

        .platform-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .platform-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .platform-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .spotify-search, .soundcloud-search, .custom-music {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        .spotify-search.active, .soundcloud-search.active, .custom-music.active {
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .search-result {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .result-album {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .result-info {
            flex: 1;
            min-width: 0;
        }

        .result-title {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-artist {
            color: var(--text-secondary);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .add-song-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s ease;
        }

        .add-song-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .custom-playlist {
            margin-top: 20px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .playlist-item.active {
            background: rgba(29, 185, 84, 0.1);
            border-left: 4px solid var(--spotify-green);
        }

        .playlist-item-actions {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }

        .playlist-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .playlist-btn:hover {
            color: var(--text-color);
        }

        /* 原有模態框樣式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .crypto-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .crypto-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .crypto-option.active {
            border-color: var(--primary-color);
            background: rgba(0, 208, 156, 0.1);
        }

        .deposit-amount input {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .quick-amount {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-color);
            text-align: center;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-actions button {
            flex: 1;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        @keyframes cardDeal {
            0% { transform: translateY(-100px) rotateY(0deg); opacity: 0; }
            100% { transform: translateY(0) rotateY(360deg); opacity: 1; }
        }

        .card-dealing {
            animation: cardDeal 0.5s ease forwards;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .music-control {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .cards-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .spotify-player {
                min-width: 250px;
            }
            
            .road-grid {
                grid-template-columns: repeat(20, 30px);
                min-width: 620px;
            }
            
            .music-platform-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- 音效元素 -->
    <audio id="cardSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-shuffle-2467.mp3" type="audio/mpeg">
    </audio>
    <audio id="dealSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-game-tap-1990.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="loseSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="chipSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-casino-chips-handling-1249.mp3" type="audio/mpeg">
    </audio>

    <!-- 真實音樂播放器 -->
    <audio id="musicPlayer" crossorigin="anonymous"></audio>

    <!-- 存款模態框 -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-wallet"></i> 存款
                </div>
                <button class="close-modal" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="crypto-options">
                <div class="crypto-option active" data-crypto="BTC">
                    <div class="crypto-icon">
                        <i class="fab fa-bitcoin"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">比特幣</div>
                        <div class="crypto-symbol">BTC</div>
                    </div>
                </div>
                
                <div class="crypto-option" data-crypto="ETH">
                    <div class="crypto-icon">
                        <i class="fab fa-ethereum"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">以太坊</div>
                        <div class="crypto-symbol">ETH</div>
                    </div>
                </div>
                
                <div class="crypto-option" data-crypto="USDT">
                    <div class="crypto-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">泰達幣</div>
                        <div class="crypto-symbol">USDT</div>
                    </div>
                </div>
            </div>
            
            <div class="deposit-amount">
                <input type="number" id="depositAmount" placeholder="輸入存款金額" min="0" step="0.01">
                <div class="quick-amounts">
                    <div class="quick-amount" data-amount="100">100</div>
                    <div class="quick-amount" data-amount="500">500</div>
                    <div class="quick-amount" data-amount="1000">1,000</div>
                    <div class="quick-amount" data-amount="5000">5,000</div>
                    <div class="quick-amount" data-amount="10000">10,000</div>
                    <div class="quick-amount" data-amount="50000">50,000</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-primary" id="confirmDeposit">
                    確認存款
                </button>
                <button class="btn-secondary" id="cancelDeposit">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 音樂選擇模態框 -->
    <div class="modal music-modal" id="musicModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-music"></i> 選擇音樂平台
                </div>
                <button class="close-modal" id="closeMusicModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="music-platform-selector">
                <div class="platform-option active" data-platform="spotify">
                    <div class="platform-icon" style="color: var(--spotify-green);">
                        <i class="fab fa-spotify"></i>
                    </div>
                    <div class="platform-name">Spotify</div>
                    <div class="platform-desc">搜尋 Spotify 歌曲</div>
                </div>
                
                <div class="platform-option" data-platform="soundcloud">
                    <div class="platform-icon" style="color: var(--soundcloud-orange);">
                        <i class="fab fa-soundcloud"></i>
                    </div>
                    <div class="platform-name">SoundCloud</div>
                    <div class="platform-desc">搜尋 SoundCloud 音樂</div>
                </div>
                
                <div class="platform-option" data-platform="custom">
                    <div class="platform-icon" style="color: var(--primary-color);">
                        <i class="fas fa-headphones"></i>
                    </div>
                    <div class="platform-name">自訂播放清單</div>
                    <div class="platform-desc">管理您的歌曲</div>
                </div>
            </div>
            
            <!-- Spotify 搜尋區域 -->
            <div class="spotify-search" id="spotifySearch">
                <input type="text" class="search-input" id="spotifySearchInput" placeholder="搜尋 Spotify 歌曲...">
                <button class="btn-primary" id="spotifySearchBtn" style="width: 100%;">
                    <i class="fas fa-search"></i> 搜尋歌曲
                </button>
                <div class="search-results" id="spotifyResults">
                    <!-- 搜尋結果動態生成 -->
                </div>
            </div>
            
            <!-- SoundCloud 搜尋區域 -->
            <div class="soundcloud-search" id="soundcloudSearch">
                <input type="text" class="search-input" id="soundcloudSearchInput" placeholder="搜尋 SoundCloud 音樂...">
                <button class="btn-primary" id="soundcloudSearchBtn" style="width: 100%;">
                    <i class="fas fa-search"></i> 搜尋音樂
                </button>
                <div class="search-results" id="soundcloudResults">
                    <!-- 搜尋結果動態生成 -->
                </div>
            </div>
            
            <!-- 自訂播放清單區域 -->
            <div class="custom-music active" id="customMusic">
                <button class="add-song-btn" id="addCustomSong">
                    <i class="fas fa-plus"></i> 新增自訂歌曲
                </button>
                
                <div class="custom-playlist">
                    <div class="playlist-header">
                        <h4 style="color: var(--primary-color);">
                            <i class="fas fa-list-music"></i> 您的播放清單
                        </h4>
                        <span id="playlistCount">0 首歌曲</span>
                    </div>
                    <div class="search-results" id="customPlaylist">
                        <!-- 播放清單動態生成 -->
                        <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                            播放清單為空，請新增歌曲
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions" style="margin-top: 25px;">
                <button class="btn-secondary" id="closeMusicModalBtn">
                    關閉
                </button>
                <button class="btn-primary" id="savePlaylist">
                    儲存播放清單
                </button>
            </div>
        </div>
    </div>

    <!-- 自訂歌曲模態框 -->
    <div class="modal" id="customSongModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-music"></i> 新增自訂歌曲
                </div>
                <button class="close-modal" id="closeCustomSongModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="crypto-options">
                <div class="crypto-option active" data-type="mp3">
                    <div class="crypto-icon">
                        <i class="fas fa-file-audio"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">MP3 檔案</div>
                        <div class="crypto-symbol">上傳或輸入網址</div>
                    </div>
                </div>
                
                <div class="crypto-option" data-type="youtube">
                    <div class="crypto-icon">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">YouTube</div>
                        <div class="crypto-symbol">YouTube 連結</div>
                    </div>
                </div>
            </div>
            
            <div class="deposit-amount">
                <input type="text" id="songTitle" placeholder="歌曲名稱" style="margin-bottom: 10px;">
                <input type="text" id="songArtist" placeholder="歌手名稱" style="margin-bottom: 10px;">
                <input type="text" id="songUrl" placeholder="MP3 網址或 YouTube 連結">
                
                <div class="quick-amounts">
                    <div class="quick-amount" data-url="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">範例 1</div>
                    <div class="quick-amount" data-url="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3">範例 2</div>
                    <div class="quick-amount" data-url="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3">範例 3</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-primary" id="addSongToPlaylist">
                    <i class="fas fa-plus"></i> 新增到播放清單
                </button>
                <button class="btn-secondary" id="cancelAddSong">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 主遊戲介面 -->
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-dice"></i>
                </div>
                <h1>加密百家樂</h1>
            </div>
            
            <div class="music-control">
                <div class="spotify-player" id="musicPlayerUI">
                    <i class="fab fa-spotify spotify-icon" id="platformIcon"></i>
                    <div class="track-info">
                        <div class="track-title" id="trackTitle">點擊選擇音樂</div>
                        <div class="track-artist" id="trackArtist">選擇您的播放清單</div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" id="prevTrack" title="上一首">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="music-btn" id="playPause" title="播放/暫停">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="music-btn" id="nextTrack" title="下一首">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" title="音量">
                        <button class="music-btn" id="openMusicModal" title="選擇音樂">
                            <i class="fas fa-music"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="wallet-info">
                <div class="balance-display">
                    <div class="total-balance" id="totalBalance">0.00</div>
                    <div class="balance-label">總餘額 (USDT)</div>
                </div>
                <button class="deposit-btn" id="openDeposit">
                    <i class="fas fa-plus-circle"></i>
                    存款
                </button>
            </div>
        </div>

        <div class="game-area">
            <div class="game-table">
                <div class="table-content">
                    <div class="cards-container">
                        <div class="player-side" id="playerSide">
                            <div class="side-label player-label">玩家 PLAYER</div>
                            <div class="cards" id="playerCards">
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="points-display player-points" id="playerPoints">0</div>
                        </div>
                        
                        <div class="banker-side" id="bankerSide">
                            <div class="side-label banker-label">莊家 BANKER</div>
                            <div class="cards" id="bankerCards">
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="points-display banker-points" id="bankerPoints">0</div>
                        </div>
                    </div>
                    
                    <div class="result-area">
                        <div class="result-text" id="resultText">請下注後開始遊戲</div>
                    </div>
                    
                    <div class="game-controls">
                        <button class="btn btn-primary" id="dealBtn">
                            <i class="fas fa-play"></i>
                            發牌
                        </button>
                        <button class="btn btn-secondary" id="newRoundBtn">
                            <i class="fas fa-redo"></i>
                            新一局
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="big-road-container">
                <h3><i class="fas fa-chart-line"></i> 大路圖</h3>
                <div class="big-road">
                    <div class="road-grid" id="roadGrid">
                        <!-- 大路圖動態生成 -->
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="betting-panel">
                <h3><i class="fas fa-coins"></i> 下注控制</h3>
                
                <div class="bet-amount-display">
                    <div class="bet-amount-value" id="betAmountValue">0</div>
                    <div id="betTargetLabel">尚未選擇下注目標</div>
                </div>
                
                <div class="bet-target-display">
                    <button class="target-btn" data-target="player">
                        <i class="fas fa-user"></i>
                        <span>玩家</span>
                        <small>賠率 1.95</small>
                    </button>
                    <button class="target-btn" data-target="banker">
                        <i class="fas fa-landmark"></i>
                        <span>莊家</span>
                        <small>賠率 1.95</small>
                    </button>
                    <button class="target-btn" data-target="tie">
                        <i class="fas fa-handshake"></i>
                        <span>和局</span>
                        <small>賠率 8.00</small>
                    </button>
                </div>
                
                <div class="amount-controls">
                    <button class="amount-btn" data-amount="10">10</button>
                    <button class="amount-btn" data-amount="50">50</button>
                    <button class="amount-btn" data-amount="100">100</button>
                    <button class="amount-btn" data-amount="500">500</button>
                    <button class="amount-btn" data-amount="1000">1,000</button>
                    <button class="amount-btn" data-amount="5000">5,000</button>
                </div>
                
                <div class="custom-amount">
                    <input type="number" id="customAmount" placeholder="自訂金額" min="0">
                    <button id="setCustomAmount">設定</button>
                </div>
                
                <div class="bet-actions">
                    <button class="btn-clear" id="clearBet">
                        清除
                    </button>
                    <button class="btn-primary" id="placeBet">
                        確認下注
                    </button>
                </div>
            </div>
            
            <div class="stats-panel">
                <h3><i class="fas fa-chart-bar"></i> 遊戲統計</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalRounds">0</div>
                        <div class="stat-label">總局數</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="playerWins">0</div>
                        <div class="stat-label">玩家勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bankerWins">0</div>
                        <div class="stat-label">莊家勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tieGames">0</div>
                        <div class="stat-label">和局</div>
                    </div>
                </div>
            </div>
            
            <div class="history-panel">
                <h3><i class="fas fa-history"></i> 交易紀錄</h3>
                <div class="history-list" id="historyList">
                    <div class="history-item" style="text-align: center; color: var(--text-secondary); padding: 30px;">
                        尚未有交易紀錄
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 遊戲狀態
        const gameState = {
            balance: 1000,
            currentBet: 0,
            currentBetTarget: null,
            isGameActive: false,
            isBetPlaced: false,
            
            totalRounds: 0,
            playerWins: 0,
            bankerWins: 0,
            tieGames: 0,
            totalProfit: 0,
            
            bigRoad: [],
            roadPosition: { row: 0, col: 0 },
            
            // 音樂狀態
            musicMode: 'custom', // 'spotify', 'soundcloud', 'custom'
            currentTrackIndex: 0,
            isPlaying: false,
            currentVolume: 50,
            
            // 播放清單
            defaultPlaylist: [
                {
                    id: '1',
                    title: 'Poker Face',
                    artist: 'Lady Gaga',
                    album: 'The Fame',
                    previewUrl: 'https://p.scdn.co/mp3-preview/64b8992f7f81d1f1fd25c575cfebec0ae033c23a',
                    duration: 238000,
                    popularity: 85,
                    platform: 'spotify'
                },
                {
                    id: '2',
                    title: 'Viva Las Vegas',
                    artist: 'Elvis Presley',
                    album: 'Viva Las Vegas',
                    previewUrl: 'https://p.scdn.co/mp3-preview/5ee8048e933dd2c4f3a3899cc77401719cf8308c',
                    duration: 152000,
                    popularity: 78,
                    platform: 'spotify'
                },
                {
                    id: '3',
                    title: 'The Gambler',
                    artist: 'Kenny Rogers',
                    album: 'The Gambler',
                    previewUrl: 'https://p.scdn.co/mp3-preview/772b7dd53465a6432e8e44776787b1c0913c75e9',
                    duration: 208000,
                    popularity: 72,
                    platform: 'spotify'
                }
            ],
            
            customPlaylist: [
                {
                    id: 'custom-1',
                    title: 'Casino Background Music',
                    artist: 'Casino Vibes',
                    album: 'Gambling Music',
                    previewUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                    duration: 180000,
                    platform: 'custom'
                },
                {
                    id: 'custom-2',
                    title: 'Poker Night',
                    artist: 'Card Game Music',
                    album: 'Casino Collection',
                    previewUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
                    duration: 210000,
                    platform: 'custom'
                }
            ],
            
            currentPlaylist: [],
            searchResults: {
                spotify: [],
                soundcloud: []
            }
        };

        // DOM元素
        const elements = {
            // 音樂控制
            trackTitle: document.getElementById('trackTitle'),
            trackArtist: document.getElementById('trackArtist'),
            playPause: document.getElementById('playPause'),
            prevTrack: document.getElementById('prevTrack'),
            nextTrack: document.getElementById('nextTrack'),
            volumeSlider: document.getElementById('volumeSlider'),
            musicPlayer: document.getElementById('musicPlayer'),
            musicPlayerUI: document.getElementById('musicPlayerUI'),
            platformIcon: document.getElementById('platformIcon'),
            openMusicModal: document.getElementById('openMusicModal'),
            
            // 模態框
            musicModal: document.getElementById('musicModal'),
            closeMusicModal: document.getElementById('closeMusicModal'),
            closeMusicModalBtn: document.getElementById('closeMusicModalBtn'),
            platformOptions: document.querySelectorAll('.platform-option'),
            
            // Spotify 搜尋
            spotifySearch: document.getElementById('spotifySearch'),
            spotifySearchInput: document.getElementById('spotifySearchInput'),
            spotifySearchBtn: document.getElementById('spotifySearchBtn'),
            spotifyResults: document.getElementById('spotifyResults'),
            
            // SoundCloud 搜尋
            soundcloudSearch: document.getElementById('soundcloudSearch'),
            soundcloudSearchInput: document.getElementById('soundcloudSearchInput'),
            soundcloudSearchBtn: document.getElementById('soundcloudSearchBtn'),
            soundcloudResults: document.getElementById('soundcloudResults'),
            
            // 自訂播放清單
            customMusic: document.getElementById('customMusic'),
            customPlaylist: document.getElementById('customPlaylist'),
            playlistCount: document.getElementById('playlistCount'),
            addCustomSong: document.getElementById('addCustomSong'),
            savePlaylist: document.getElementById('savePlaylist'),
            
            // 自訂歌曲模態框
            customSongModal: document.getElementById('customSongModal'),
            closeCustomSongModal: document.getElementById('closeCustomSongModal'),
            cancelAddSong: document.getElementById('cancelAddSong'),
            addSongToPlaylist: document.getElementById('addSongToPlaylist'),
            songTitle: document.getElementById('songTitle'),
            songArtist: document.getElementById('songArtist'),
            songUrl: document.getElementById('songUrl'),
            songTypeOptions: document.querySelectorAll('[data-type]'),
            quickUrlButtons: document.querySelectorAll('[data-url]'),
            
            // 存款相關
            totalBalance: document.getElementById('totalBalance'),
            depositModal: document.getElementById('depositModal'),
            openDeposit: document.getElementById('openDeposit'),
            closeModal: document.getElementById('closeModal'),
            cancelDeposit: document.getElementById('cancelDeposit'),
            confirmDeposit: document.getElementById('confirmDeposit'),
            depositAmount: document.getElementById('depositAmount'),
            cryptoOptions: document.querySelectorAll('.crypto-option'),
            quickAmounts: document.querySelectorAll('.quick-amount'),
            
            // 遊戲控制
            playerCardsContainer: document.getElementById('playerCards'),
            bankerCardsContainer: document.getElementById('bankerCards'),
            playerPoints: document.getElementById('playerPoints'),
            bankerPoints: document.getElementById('bankerPoints'),
            resultText: document.getElementById('resultText'),
            dealBtn: document.getElementById('dealBtn'),
            newRoundBtn: document.getElementById('newRoundBtn'),
            
            // 大路圖
            roadGrid: document.getElementById('roadGrid'),
            
            // 下注控制
            betAmountValue: document.getElementById('betAmountValue'),
            betTargetLabel: document.getElementById('betTargetLabel'),
            targetButtons: document.querySelectorAll('.target-btn'),
            amountButtons: document.querySelectorAll('.amount-btn'),
            customAmount: document.getElementById('customAmount'),
            setCustomAmount: document.getElementById('setCustomAmount'),
            clearBet: document.getElementById('clearBet'),
            placeBet: document.getElementById('placeBet'),
            
            // 統計數據
            totalRounds: document.getElementById('totalRounds'),
            playerWins: document.getElementById('playerWins'),
            bankerWins: document.getElementById('bankerWins'),
            tieGames: document.getElementById('tieGames'),
            
            // 歷史紀錄
            historyList: document.getElementById('historyList')
        };

        // 音效元素
        const audioElements = {
            cardSound: document.getElementById('cardSound'),
            dealSound: document.getElementById('dealSound'),
            winSound: document.getElementById('winSound'),
            loseSound: document.getElementById('loseSound'),
            chipSound: document.getElementById('chipSound')
        };

        // 初始化
        function init() {
            setupEventListeners();
            setupMusicSystem();
            updateUI();
            initRoadGrid();
            loadPlaylist();
        }

        // 音樂系統設置
        function setupMusicSystem() {
            // 設置音量
            Object.values(audioElements).forEach(audio => {
                if (audio) audio.volume = gameState.currentVolume / 100;
            });
            elements.musicPlayer.volume = gameState.currentVolume / 100;
            
            // 設置音量滑塊
            elements.volumeSlider.value = gameState.currentVolume;
            elements.volumeSlider.addEventListener('input', (e) => {
                gameState.currentVolume = e.target.value;
                updateVolume();
            });
            
            // 音樂播放器事件監聽
            elements.musicPlayer.addEventListener('ended', nextTrack);
            elements.musicPlayer.addEventListener('error', handleMusicError);
        }

        function loadPlaylist() {
            // 合併預設和自訂播放清單
            gameState.currentPlaylist = [...gameState.defaultPlaylist, ...gameState.customPlaylist];
            
            // 更新播放清單顯示
            updateCustomPlaylist();
            
            // 載入第一首歌
            if (gameState.currentPlaylist.length > 0) {
                const track = gameState.currentPlaylist[gameState.currentTrackIndex];
                updateTrackInfo(track);
                updatePlayerUI(track);
            }
        }

        function updateTrackInfo(track) {
            elements.trackTitle.textContent = track.title;
            elements.trackArtist.textContent = `${track.artist} • ${track.platform === 'custom' ? '自訂歌曲' : track.album}`;
        }

        function updatePlayerUI(track) {
            // 更新平台圖標
            const platformIcon = elements.platformIcon;
            const musicPlayerUI = elements.musicPlayerUI;
            
            if (track.platform === 'spotify') {
                platformIcon.className = 'fab fa-spotify spotify-icon';
                musicPlayerUI.className = 'spotify-player';
                musicPlayerUI.style.borderColor = 'var(--spotify-green)';
            } else if (track.platform === 'soundcloud') {
                platformIcon.className = 'fab fa-soundcloud soundcloud-icon';
                musicPlayerUI.className = 'spotify-player soundcloud-player';
                musicPlayerUI.style.borderColor = 'var(--soundcloud-orange)';
            } else {
                platformIcon.className = 'fas fa-headphones spotify-icon';
                musicPlayerUI.className = 'spotify-player';
                musicPlayerUI.style.borderColor = 'var(--primary-color)';
            }
            
            // 更新標題顏色
            const trackTitle = elements.trackTitle;
            if (track.platform === 'soundcloud') {
                trackTitle.style.color = 'var(--soundcloud-orange)';
            } else if (track.platform === 'custom') {
                trackTitle.style.color = 'var(--primary-color)';
            } else {
                trackTitle.style.color = 'var(--spotify-green)';
            }
        }

        function updateVolume() {
            const volume = gameState.currentVolume / 100;
            elements.musicPlayer.volume = volume;
            Object.values(audioElements).forEach(audio => {
                if (audio) audio.volume = volume;
            });
        }

        function playSound(sound) {
            if (!sound) return;
            sound.currentTime = 0;
            sound.play().catch(e => console.log('音效播放失敗:', e));
        }

        // 音樂控制函數
        function togglePlayPause() {
            if (gameState.isPlaying) {
                pauseMusic();
            } else {
                playMusic();
            }
        }

        function playMusic() {
            if (gameState.currentPlaylist.length === 0) {
                alert('播放清單為空，請先新增歌曲');
                return;
            }
            
            const track = gameState.currentPlaylist[gameState.currentTrackIndex];
            
            if (!track.previewUrl) {
                alert('此曲目沒有可播放的音頻');
                return;
            }
            
            // 設置音樂來源
            if (track.platform === 'youtube') {
                // 處理 YouTube 連結
                alert('YouTube 連結需要在瀏覽器中直接播放');
                return;
            }
            
            elements.musicPlayer.src = track.previewUrl;
            
            elements.musicPlayer.play().then(() => {
                gameState.isPlaying = true;
                updatePlayPauseButton();
            }).catch(e => {
                console.log('音樂播放失敗:', e);
                alert('無法播放音樂，請檢查網路連線或音頻連結');
            });
        }

        function pauseMusic() {
            elements.musicPlayer.pause();
            gameState.isPlaying = false;
            updatePlayPauseButton();
        }

        function updatePlayPauseButton() {
            const icon = elements.playPause.querySelector('i');
            if (gameState.isPlaying) {
                icon.className = 'fas fa-pause';
                elements.playPause.classList.add('active');
            } else {
                icon.className = 'fas fa-play';
                elements.playPause.classList.remove('active');
            }
        }

        function prevTrack() {
            if (gameState.currentPlaylist.length === 0) return;
            
            gameState.currentTrackIndex = (gameState.currentTrackIndex - 1 + gameState.currentPlaylist.length) % gameState.currentPlaylist.length;
            const track = gameState.currentPlaylist[gameState.currentTrackIndex];
            updateTrackInfo(track);
            updatePlayerUI(track);
            
            if (gameState.isPlaying) {
                pauseMusic();
                setTimeout(playMusic, 100);
            }
        }

        function nextTrack() {
            if (gameState.currentPlaylist.length === 0) return;
            
            gameState.currentTrackIndex = (gameState.currentTrackIndex + 1) % gameState.currentPlaylist.length;
            const track = gameState.currentPlaylist[gameState.currentTrackIndex];
            updateTrackInfo(track);
            updatePlayerUI(track);
            
            if (gameState.isPlaying) {
                pauseMusic();
                setTimeout(playMusic, 100);
            }
        }

        function handleMusicError(e) {
            console.log('音樂播放錯誤:', e);
            alert('音樂播放失敗，正在切換到下一首');
            nextTrack();
        }

        // Spotify 搜尋功能（模擬）
        function searchSpotify(query) {
            if (!query.trim()) {
                alert('請輸入搜尋關鍵字');
                return;
            }
            
            // 模擬搜尋結果（實際應用中會調用 Spotify API）
            const mockResults = [
                {
                    id: 'spotify-search-1',
                    title: `${query} - Remix`,
                    artist: 'Various Artists',
                    album: 'Casino Mix 2024',
                    previewUrl: 'https://p.scdn.co/mp3-preview/64b8992f7f81d1f1fd25c575cfebec0ae033c23a',
                    duration: 180000,
                    platform: 'spotify'
                },
                {
                    id: 'spotify-search-2',
                    title: `Gambling with ${query}`,
                    artist: 'DJ Casino',
                    album: 'Poker Anthems',
                    previewUrl: 'https://p.scdn.co/mp3-preview/5ee8048e933dd2c4f3a3899cc77401719cf8308c',
                    duration: 210000,
                    platform: 'spotify'
                },
                {
                    id: 'spotify-search-3',
                    title: `${query} Nights`,
                    artist: 'Vegas Sounds',
                    album: 'Casino Vibes',
                    previewUrl: 'https://p.scdn.co/mp3-preview/772b7dd53465a6432e8e44776787b1c0913c75e9',
                    duration: 195000,
                    platform: 'spotify'
                }
            ];
            
            gameState.searchResults.spotify = mockResults;
            displaySpotifyResults();
        }

        function displaySpotifyResults() {
            const resultsContainer = elements.spotifyResults;
            resultsContainer.innerHTML = '';
            
            if (gameState.searchResults.spotify.length === 0) {
                resultsContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 30px;">沒有找到相關結果</div>';
                return;
            }
            
            gameState.searchResults.spotify.forEach((track, index) => {
                const resultElement = document.createElement('div');
                resultElement.className = 'search-result';
                resultElement.innerHTML = `
                    <div class="result-album" style="background: linear-gradient(135deg, #${Math.floor(Math.random()*16777215).toString(16)}, #${Math.floor(Math.random()*16777215).toString(16)});">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="result-info">
                        <div class="result-title">${track.title}</div>
                        <div class="result-artist">${track.artist} • ${track.album}</div>
                    </div>
                    <button class="playlist-btn add-to-playlist" data-index="${index}" data-platform="spotify" title="新增到播放清單">
                        <i class="fas fa-plus"></i>
                    </button>
                `;
                resultsContainer.appendChild(resultElement);
            });
            
            // 添加事件監聽器
            document.querySelectorAll('.add-to-playlist[data-platform="spotify"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.dataset.index);
                    addToCustomPlaylist(gameState.searchResults.spotify[index]);
                });
            });
        }

        // SoundCloud 搜尋功能（模擬）
        function searchSoundCloud(query) {
            if (!query.trim()) {
                alert('請輸入搜尋關鍵字');
                return;
            }
            
            // 模擬搜尋結果
            const mockResults = [
                {
                    id: 'soundcloud-search-1',
                    title: `${query} Mix`,
                    artist: 'SoundCloud DJ',
                    album: 'Underground Casino',
                    previewUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                    duration: 220000,
                    platform: 'soundcloud'
                },
                {
                    id: 'soundcloud-search-2',
                    title: `${query} Beats`,
                    artist: 'Cloud Beats',
                    album: 'Independent Mix',
                    previewUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
                    duration: 190000,
                    platform: 'soundcloud'
                },
                {
                    id: 'soundcloud-search-3',
                    title: `${query} Vibes`,
                    artist: 'Vibe Creator',
                    album: 'Chill Casino',
                    previewUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
                    duration: 205000,
                    platform: 'soundcloud'
                }
            ];
            
            gameState.searchResults.soundcloud = mockResults;
            displaySoundCloudResults();
        }

        function displaySoundCloudResults() {
            const resultsContainer = elements.soundcloudResults;
            resultsContainer.innerHTML = '';
            
            if (gameState.searchResults.soundcloud.length === 0) {
                resultsContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 30px;">沒有找到相關結果</div>';
                return;
            }
            
            gameState.searchResults.soundcloud.forEach((track, index) => {
                const resultElement = document.createElement('div');
                resultElement.className = 'search-result';
                resultElement.innerHTML = `
                    <div class="result-album" style="background: linear-gradient(135deg, #ff8800, #ff5500);">
                        <i class="fab fa-soundcloud"></i>
                    </div>
                    <div class="result-info">
                        <div class="result-title">${track.title}</div>
                        <div class="result-artist">${track.artist} • ${track.album}</div>
                    </div>
                    <button class="playlist-btn add-to-playlist" data-index="${index}" data-platform="soundcloud" title="新增到播放清單">
                        <i class="fas fa-plus"></i>
                    </button>
                `;
                resultsContainer.appendChild(resultElement);
            });
            
            // 添加事件監聽器
            document.querySelectorAll('.add-to-playlist[data-platform="soundcloud"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.dataset.index);
                    addToCustomPlaylist(gameState.searchResults.soundcloud[index]);
                });
            });
        }

        // 自訂播放清單功能
        function updateCustomPlaylist() {
            const playlistContainer = elements.customPlaylist;
            const playlistCount = elements.playlistCount;
            
            playlistContainer.innerHTML = '';
            
            if (gameState.customPlaylist.length === 0) {
                playlistContainer.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 30px;">播放清單為空，請新增歌曲</div>';
                playlistCount.textContent = '0 首歌曲';
                return;
            }
            
            playlistCount.textContent = `${gameState.customPlaylist.length} 首歌曲`;
            
            gameState.customPlaylist.forEach((track, index) => {
                const isActive = gameState.currentTrackIndex === (gameState.defaultPlaylist.length + index) && 
                               gameState.currentPlaylist[gameState.currentTrackIndex]?.id === track.id;
                
                const playlistItem = document.createElement('div');
                playlistItem.className = `playlist-item ${isActive ? 'active' : ''}`;
                playlistItem.innerHTML = `
                    <div class="result-album" style="background: ${track.platform === 'soundcloud' ? 'linear-gradient(135deg, #ff8800, #ff5500)' : 'linear-gradient(135deg, var(--primary-color), var(--secondary-color))'};">
                        <i class="fas ${track.platform === 'soundcloud' ? 'fa-soundcloud' : 'fa-music'}"></i>
                    </div>
                    <div class="result-info">
                        <div class="result-title">${track.title}</div>
                        <div class="result-artist">${track.artist}</div>
                    </div>
                    <div class="playlist-item-actions">
                        <button class="playlist-btn play-now" data-index="${index}" title="立即播放">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="playlist-btn remove-song" data-index="${index}" title="移除歌曲">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                playlistContainer.appendChild(playlistItem);
            });
            
            // 添加事件監聽器
            document.querySelectorAll('.play-now').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.dataset.index);
                    playCustomTrack(index);
                });
            });
            
            document.querySelectorAll('.remove-song').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.dataset.index);
                    removeFromCustomPlaylist(index);
                });
            });
        }

        function addToCustomPlaylist(track) {
            // 檢查是否已經存在
            const exists = gameState.customPlaylist.some(item => 
                item.title === track.title && item.artist === track.artist
            );
            
            if (exists) {
                alert('此歌曲已經在播放清單中');
                return;
            }
            
            // 添加到自訂播放清單
            const customTrack = {
                ...track,
                id: `custom-${Date.now()}`,
                platform: track.platform || 'custom'
            };
            
            gameState.customPlaylist.push(customTrack);
            gameState.currentPlaylist = [...gameState.defaultPlaylist, ...gameState.customPlaylist];
            
            updateCustomPlaylist();
            alert('已新增到播放清單');
        }

        function removeFromCustomPlaylist(index) {
            if (confirm('確定要移除這首歌曲嗎？')) {
                gameState.customPlaylist.splice(index, 1);
                gameState.currentPlaylist = [...gameState.defaultPlaylist, ...gameState.customPlaylist];
                
                // 如果移除的是當前播放的歌曲，切換到下一首
                const currentTrack = gameState.currentPlaylist[gameState.currentTrackIndex];
                if (!currentTrack || !gameState.customPlaylist.some(track => track.id === currentTrack.id)) {
                    gameState.currentTrackIndex = Math.max(0, Math.min(gameState.currentTrackIndex, gameState.currentPlaylist.length - 1));
                    if (gameState.currentPlaylist.length > 0) {
                        const newTrack = gameState.currentPlaylist[gameState.currentTrackIndex];
                        updateTrackInfo(newTrack);
                        updatePlayerUI(newTrack);
                    }
                }
                
                updateCustomPlaylist();
                savePlaylistToLocalStorage();
            }
        }

        function playCustomTrack(index) {
            const trackIndex = gameState.defaultPlaylist.length + index;
            gameState.currentTrackIndex = trackIndex;
            
            const track = gameState.currentPlaylist[trackIndex];
            updateTrackInfo(track);
            updatePlayerUI(track);
            
            if (gameState.isPlaying) {
                pauseMusic();
                setTimeout(playMusic, 100);
            } else {
                playMusic();
            }
            
            updateCustomPlaylist();
        }

        function addCustomSong() {
            const title = elements.songTitle.value.trim();
            const artist = elements.songArtist.value.trim();
            const url = elements.songUrl.value.trim();
            const type = document.querySelector('.crypto-option.active[data-type]')?.dataset.type;
            
            if (!title || !artist || !url) {
                alert('請填寫所有欄位');
                return;
            }
            
            if (!url.startsWith('http')) {
                alert('請輸入有效的網址');
                return;
            }
            
            const newSong = {
                id: `custom-${Date.now()}`,
                title: title,
                artist: artist,
                album: '自訂歌曲',
                previewUrl: url,
                duration: 180000,
                platform: type === 'youtube' ? 'youtube' : 'custom'
            };
            
            gameState.customPlaylist.push(newSong);
            gameState.currentPlaylist = [...gameState.defaultPlaylist, ...gameState.customPlaylist];
            
            updateCustomPlaylist();
            savePlaylistToLocalStorage();
            
            // 清空表單
            elements.songTitle.value = '';
            elements.songArtist.value = '';
            elements.songUrl.value = '';
            
            // 關閉模態框
            elements.customSongModal.classList.remove('active');
            
            alert('歌曲已新增到播放清單');
        }

        function savePlaylistToLocalStorage() {
            try {
                localStorage.setItem('baccaratCustomPlaylist', JSON.stringify(gameState.customPlaylist));
            } catch (e) {
                console.log('無法儲存播放清單:', e);
            }
        }

        function loadPlaylistFromLocalStorage() {
            try {
                const saved = localStorage.getItem('baccaratCustomPlaylist');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed)) {
                        gameState.customPlaylist = parsed;
                        return true;
                    }
                }
            } catch (e) {
                console.log('無法載入播放清單:', e);
            }
            return false;
        }

        // 事件監聽器設置
        function setupEventListeners() {
            // 音樂控制
            elements.playPause.addEventListener('click', togglePlayPause);
            elements.prevTrack.addEventListener('click', prevTrack);
            elements.nextTrack.addEventListener('click', nextTrack);
            elements.musicPlayerUI.addEventListener('click', () => {
                elements.musicModal.classList.add('active');
            });
            elements.openMusicModal.addEventListener('click', () => {
                elements.musicModal.classList.add('active');
            });
            
            // 音樂模態框
            elements.closeMusicModal.addEventListener('click', () => {
                elements.musicModal.classList.remove('active');
            });
            elements.closeMusicModalBtn.addEventListener('click', () => {
                elements.musicModal.classList.remove('active');
            });
            
            // 平台選擇
            elements.platformOptions.forEach(option => {
                option.addEventListener('click', () => {
                    elements.platformOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    const platform = option.dataset.platform;
                    
                    // 顯示對應的搜尋區域
                    elements.spotifySearch.classList.remove('active');
                    elements.soundcloudSearch.classList.remove('active');
                    elements.customMusic.classList.remove('active');
                    
                    if (platform === 'spotify') {
                        elements.spotifySearch.classList.add('active');
                    } else if (platform === 'soundcloud') {
                        elements.soundcloudSearch.classList.add('active');
                    } else {
                        elements.customMusic.classList.add('active');
                    }
                });
            });
            
            // Spotify 搜尋
            elements.spotifySearchBtn.addEventListener('click', () => {
                const query = elements.spotifySearchInput.value;
                searchSpotify(query);
            });
            
            // SoundCloud 搜尋
            elements.soundcloudSearchBtn.addEventListener('click', () => {
                const query = elements.soundcloudSearchInput.value;
                searchSoundCloud(query);
            });
            
            // 自訂歌曲
            elements.addCustomSong.addEventListener('click', () => {
                elements.customSongModal.classList.add('active');
            });
            
            elements.closeCustomSongModal.addEventListener('click', () => {
                elements.customSongModal.classList.remove('active');
            });
            
            elements.cancelAddSong.addEventListener('click', () => {
                elements.customSongModal.classList.remove('active');
            });
            
            elements.addSongToPlaylist.addEventListener('click', addCustomSong);
            
            elements.songTypeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    elements.songTypeOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    const type = option.dataset.type;
                    elements.songUrl.placeholder = type === 'youtube' ? 'YouTube 影片連結' : 'MP3 網址';
                });
            });
            
            elements.quickUrlButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.songUrl.value = btn.dataset.url;
                    elements.songTitle.value = btn.textContent;
                    elements.songArtist.value = '範例音樂';
                });
            });
            
            // 儲存播放清單
            elements.savePlaylist.addEventListener('click', () => {
                savePlaylistToLocalStorage();
                alert('播放清單已儲存');
                elements.musicModal.classList.remove('active');
            });
            
            // 存款相關
            elements.openDeposit.addEventListener('click', () => {
                elements.depositModal.classList.add('active');
            });
            
            elements.closeModal.addEventListener('click', () => {
                elements.depositModal.classList.remove('active');
            });
            
            elements.cancelDeposit.addEventListener('click', () => {
                elements.depositModal.classList.remove('active');
            });
            
            elements.confirmDeposit.addEventListener('click', confirmDeposit);
            
            elements.cryptoOptions.forEach(option => {
                option.addEventListener('click', () => {
                    elements.cryptoOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                });
            });
            
            elements.quickAmounts.forEach(amount => {
                amount.addEventListener('click', () => {
                    elements.depositAmount.value = amount.dataset.amount;
                });
            });
            
            // 遊戲控制
            elements.dealBtn.addEventListener('click', dealCards);
            elements.newRoundBtn.addEventListener('click', newRound);
            
            // 下注控制
            elements.targetButtons.forEach(btn => {
                btn.addEventListener('click', () => selectBetTarget(btn.dataset.target));
            });
            
            elements.amountButtons.forEach(btn => {
                btn.addEventListener('click', () => addToBet(parseFloat(btn.dataset.amount)));
            });
            
            elements.setCustomAmount.addEventListener('click', () => {
                const amount = parseFloat(elements.customAmount.value);
                if (amount > 0) setBetAmount(amount);
            });
            
            elements.clearBet.addEventListener('click', clearBet);
            elements.placeBet.addEventListener('click', placeBet);
            
            // 載入儲存的播放清單
            window.addEventListener('load', () => {
                if (loadPlaylistFromLocalStorage()) {
                    loadPlaylist();
                }
            });
        }

        // 遊戲邏輯（保持不變）
        function selectBetTarget(target) {
            if (gameState.isGameActive) return;
            
            elements.targetButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-target="${target}"]`).classList.add('active');
            
            gameState.currentBetTarget = target;
            elements.betTargetLabel.textContent = `下注: ${target === 'player' ? '玩家' : target === 'banker' ? '莊家' : '和局'}`;
            playSound(audioElements.chipSound);
        }

        function addToBet(amount) {
            if (gameState.isGameActive) return;
            
            const newAmount = gameState.currentBet + amount;
            if (newAmount > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.currentBet = newAmount;
            updateBetUI();
            playSound(audioElements.chipSound);
        }

        function setBetAmount(amount) {
            if (gameState.isGameActive) return;
            
            if (amount > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.currentBet = amount;
            updateBetUI();
            playSound(audioElements.chipSound);
        }

        function clearBet() {
            if (gameState.isGameActive) return;
            
            gameState.currentBet = 0;
            gameState.currentBetTarget = null;
            gameState.isBetPlaced = false;
            
            elements.targetButtons.forEach(btn => btn.classList.remove('active'));
            updateBetUI();
            elements.resultText.textContent = '請下注後開始遊戲';
            playSound(audioElements.chipSound);
        }

        function placeBet() {
            if (gameState.isGameActive) {
                alert('遊戲進行中！');
                return;
            }
            
            if (gameState.currentBet <= 0) {
                alert('請選擇下注金額！');
                return;
            }
            
            if (!gameState.currentBetTarget) {
                alert('請選擇下注目標！');
                return;
            }
            
            if (gameState.currentBet > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.isBetPlaced = true;
            gameState.balance -= gameState.currentBet;
            
            updateUI();
            elements.resultText.textContent = '下注成功！準備發牌...';
            playSound(audioElements.chipSound);
        }

        async function dealCards() {
            if (!gameState.isBetPlaced) {
                alert('請先下注！');
                return;
            }
            
            if (gameState.isGameActive) {
                alert('遊戲進行中！');
                return;
            }
            
            gameState.isGameActive = true;
            elements.dealBtn.disabled = true;
            
            // 重置卡片顯示
            resetCards();
            
            // 發牌邏輯
            await dealGame();
            
            gameState.isGameActive = false;
            gameState.isBetPlaced = false;
            elements.dealBtn.disabled = false;
        }

        function newRound() {
            if (gameState.isGameActive) {
                alert('遊戲進行中！');
                return;
            }
            
            clearBet();
            resetCards();
            elements.resultText.textContent = '請下注後開始遊戲';
        }

        // 卡片和遊戲邏輯（保持不變）
        function resetCards() {
            const playerCards = elements.playerCardsContainer.children;
            const bankerCards = elements.bankerCardsContainer.children;
            
            for (let i = 0; i < 3; i++) {
                playerCards[i].className = 'card placeholder';
                playerCards[i].children[0].textContent = '';
                playerCards[i].children[1].innerHTML = i === 2 ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-question"></i>';
                playerCards[i].style.opacity = i === 2 ? '0.5' : '1';
                
                bankerCards[i].className = 'card placeholder';
                bankerCards[i].children[0].textContent = '';
                bankerCards[i].children[1].innerHTML = i === 2 ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-question"></i>';
                bankerCards[i].style.opacity = i === 2 ? '0.5' : '1';
            }
            
            elements.playerPoints.textContent = '0';
            elements.bankerPoints.textContent = '0';
        }

        async function dealGame() {
            // 初始化牌組
            gameState.playerCards = [null, null, null];
            gameState.bankerCards = [null, null, null];
            
            // 發前兩張牌
            await dealInitialCards();
            
            // 計算點數
            const playerFirstTwo = calculatePoints([gameState.playerCards[0], gameState.playerCards[1]]);
            const bankerFirstTwo = calculatePoints([gameState.bankerCards[0], gameState.bankerCards[1]]);
            
            // 玩家補牌
            if (playerFirstTwo <= 5) {
                await dealThirdCard('player');
            }
            
            // 莊家補牌
            const playerThird = gameState.playerCards[2];
            let bankerDraws = false;
            
            if (bankerFirstTwo <= 2) {
                bankerDraws = true;
            } else if (bankerFirstTwo === 3) {
                if (playerThird && getCardValue(playerThird) !== 8) bankerDraws = true;
            } else if (bankerFirstTwo === 4) {
                if (playerThird && getCardValue(playerThird) >= 2 && getCardValue(playerThird) <= 7) bankerDraws = true;
            } else if (bankerFirstTwo === 5) {
                if (playerThird && getCardValue(playerThird) >= 4 && getCardValue(playerThird) <= 7) bankerDraws = true;
            } else if (bankerFirstTwo === 6) {
                if (playerThird && (getCardValue(playerThird) === 6 || getCardValue(playerThird) === 7)) bankerDraws = true;
            }
            
            if (bankerDraws) {
                await dealThirdCard('banker');
            }
            
            // 計算最終結果
            const playerFinal = calculatePoints(gameState.playerCards.filter(c => c));
            const bankerFinal = calculatePoints(gameState.bankerCards.filter(c => c));
            
            elements.playerPoints.textContent = playerFinal;
            elements.bankerPoints.textContent = bankerFinal;
            
            // 判斷勝負
            let result = '';
            if (playerFinal > bankerFinal) {
                result = 'player';
                elements.resultText.textContent = '玩家勝！';
                elements.resultText.className = 'result-text winner-player';
            } else if (playerFinal < bankerFinal) {
                result = 'banker';
                elements.resultText.textContent = '莊家勝！';
                elements.resultText.className = 'result-text winner-banker';
            } else {
                result = 'tie';
                elements.resultText.textContent = '和局！';
                elements.resultText.className = 'result-text winner-tie';
            }
            
            // 計算盈利
            const profit = calculateProfit(result);
            gameState.balance += profit;
            gameState.totalProfit += profit - gameState.currentBet;
            
            // 更新統計
            gameState.totalRounds++;
            if (result === 'player') gameState.playerWins++;
            else if (result === 'banker') gameState.bankerWins++;
            else gameState.tieGames++;
            
            // 更新大路圖
            updateBigRoad(result);
            
            // 更新UI
            updateUI();
            
            // 播放音效
            if (profit > gameState.currentBet) {
                playSound(audioElements.winSound);
            } else {
                playSound(audioElements.loseSound);
            }
        }

        async function dealInitialCards() {
            // 玩家第一張
            gameState.playerCards[0] = getRandomCard();
            await revealCard('player', 0, gameState.playerCards[0]);
            
            // 莊家第一張
            gameState.bankerCards[0] = getRandomCard();
            await revealCard('banker', 0, gameState.bankerCards[0]);
            
            // 玩家第二張
            gameState.playerCards[1] = getRandomCard();
            await revealCard('player', 1, gameState.playerCards[1]);
            
            // 莊家第二張
            gameState.bankerCards[1] = getRandomCard();
            await revealCard('banker', 1, gameState.bankerCards[1]);
        }

        async function dealThirdCard(side) {
            if (side === 'player') {
                gameState.playerCards[2] = getRandomCard();
                await revealCard('player', 2, gameState.playerCards[2]);
            } else {
                gameState.bankerCards[2] = getRandomCard();
                await revealCard('banker', 2, gameState.bankerCards[2]);
            }
        }

        async function revealCard(side, index, card) {
            const container = side === 'player' ? elements.playerCardsContainer : elements.bankerCardsContainer;
            const cardElement = container.children[index];
            
            playSound(audioElements.dealSound);
            
            cardElement.classList.remove('placeholder');
            cardElement.classList.add('card-dealing');
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            cardElement.classList.add('flipped');
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const color = Math.random() > 0.5 ? 'red' : 'black';
            cardElement.children[0].textContent = card;
            cardElement.children[0].classList.add(color);
            
            await new Promise(resolve => setTimeout(resolve, 200));
        }

        // 卡片相關函數
        function getRandomCard() {
            const cards = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            return cards[Math.floor(Math.random() * cards.length)];
        }

        function getCardValue(card) {
            if (!card) return 0;
            if (card === 'A') return 1;
            if (card === '10' || card === 'J' || card === 'Q' || card === 'K') return 0;
            return parseInt(card);
        }

        function calculatePoints(cards) {
            let total = 0;
            cards.forEach(card => {
                if (card) total += getCardValue(card);
            });
            return total % 10;
        }

        function calculateProfit(result) {
            if (result === gameState.currentBetTarget) {
                switch(result) {
                    case 'player':
                    case 'banker':
                        return gameState.currentBet * 1.95;
                    case 'tie':
                        return gameState.currentBet * 8.00;
                }
            } else if (result === 'tie') {
                return gameState.currentBet;
            }
            return 0;
        }

        // 大路圖函數
        function initRoadGrid() {
            elements.roadGrid.innerHTML = '';
            for (let row = 0; row < 6; row++) {
                for (let col = 0; col < 40; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'road-cell empty-road';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    elements.roadGrid.appendChild(cell);
                }
            }
        }

        function updateBigRoad(result) {
            gameState.bigRoad.push(result);
            
            // 標準大路圖算法
            let placed = false;
            for (let col = 0; col < 40 && !placed; col++) {
                for (let row = 0; row < 6 && !placed; row++) {
                    const cellIndex = row * 40 + col;
                    const cell = elements.roadGrid.children[cellIndex];
                    
                    if (cell.classList.contains('empty-road')) {
                        cell.className = 'road-cell';
                        if (result === 'player') {
                            cell.classList.add('player-road');
                            cell.textContent = 'P';
                        } else if (result === 'banker') {
                            cell.classList.add('banker-road');
                            cell.textContent = 'B';
                        } else {
                            cell.classList.add('tie-road');
                        }
                        placed = true;
                    }
                }
            }
        }

        // UI更新
        function updateUI() {
            elements.totalBalance.textContent = gameState.balance.toFixed(2);
            elements.totalRounds.textContent = gameState.totalRounds;
            elements.playerWins.textContent = gameState.playerWins;
            elements.bankerWins.textContent = gameState.bankerWins;
            elements.tieGames.textContent = gameState.tieGames;
        }

        function updateBetUI() {
            elements.betAmountValue.textContent = gameState.currentBet.toFixed(2);
        }

        // 存款功能
        function confirmDeposit() {
            const amount = parseFloat(elements.depositAmount.value);
            if (!amount || amount <= 0) {
                alert('請輸入有效的存款金額');
                return;
            }
            
            gameState.balance += amount;
            updateUI();
            elements.depositModal.classList.remove('active');
            elements.resultText.textContent = `存款成功！存入 ${amount} USDT`;
            
            setTimeout(() => {
                if (!gameState.isBetPlaced) {
                    elements.resultText.textContent = '請下注後開始遊戲';
                }
            }, 3000);
        }

        // 初始化遊戲
        init();
    </script>
</body>
</html>
