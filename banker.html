<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密百家樂 | Crypto Baccarat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00d09c;
            --secondary-color: #1db954;
            --spotify-green: #1db954;
            --soundcloud-orange: #ff8800;
            --youtube-red: #ff0000;
            --danger-color: #ff4757;
            --warning-color: #ffa502;
            --dark-bg: #0f1525;
            --darker-bg: #0a0e1a;
            --card-bg: #1a2238;
            --text-color: #ffffff;
            --text-secondary: #8a94ad;
            --player-color: #3498db;
            --banker-color: #e74c3c;
            --tie-color: #f39c12;
            /* 新增 - 閒對/莊對顏色 */
            --player-pair-color: #3498db;
            --banker-pair-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }

        /* 調整 Header/Logo/Wallet 樣式 (與原本代碼相似) */
        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: var(--primary-color);
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .balance-display {
            text-align: right;
        }

        .total-balance {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .deposit-btn {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deposit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 208, 156, 0.3);
        }
        /* 遊戲區域 & 投注面板/統計面板 樣式 (與原本代碼相似) */

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .game-table {
            background: linear-gradient(145deg, #1a2238, #141b2d);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .table-content {
            position: relative;
            z-index: 2;
        }

        .cards-container {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            gap: 50px;
        }

        .player-side, .banker-side {
            text-align: center;
            flex: 1;
            padding: 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.03);
        }

        .side-label {
            font-size: 1.8rem;
            margin-bottom: 30px;
            padding: 15px 40px;
            border-radius: 50px;
            display: inline-block;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            border: 3px solid;
        }

        .player-label {
            background: rgba(52, 152, 219, 0.1);
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-label {
            background: rgba(231, 76, 60, 0.1);
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            min-height: 180px;
            align-items: center;
        }

        .card {
            width: 120px;
            height: 170px;
            background: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            color: #1a2238;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-front {
            background: white;
            transform: rotateY(0deg);
        }

        .card-back {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transform: rotateY(180deg);
            color: white;
            font-size: 2rem;
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.placeholder {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .points-display {
            font-size: 2.8rem;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            display: inline-block;
            min-width: 200px;
            border: 3px solid;
        }

        .player-points {
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-points {
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .result-area {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .result-text {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .winner-player {
            color: var(--player-color);
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.7);
        }

        .winner-banker {
            color: var(--banker-color);
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
        }

        .winner-tie {
            color: var(--tie-color);
            text-shadow: 0 0 20px rgba(243, 156, 18, 0.7);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 30px;
        }

        .btn {
            padding: 18px 45px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 10px 25px rgba(0, 208, 156, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 208, 156, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* 牌路樣式 - 大路 */
        .big-road-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }

        .big-road-container h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .big-road {
            background: #0a0e1a;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 5px;
            width: max-content; /* 確保內容不會被容器限制 */
        }

        .road-grid {
            display: grid;
            grid-template-columns: repeat(60, 20px); /* 增加到 60 欄 */
            grid-template-rows: repeat(6, 20px);
            gap: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .road-cell {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05); /* 網格線 */
            box-sizing: border-box;
        }

        .road-circle {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .banker-road-circle {
            border: 2px solid var(--banker-color);
            color: var(--banker-color);
        }

        .player-road-circle {
            border: 2px solid var(--player-color);
            color: var(--player-color);
        }

        /* 領帶/和局點 */
        .tie-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--tie-color);
            right: 1px;
            bottom: 1px;
        }

        /* 莊對/閒對點 - 左下/右上 */
        .banker-pair-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--banker-pair-color);
            right: 1px;
            top: 1px;
        }

        .player-pair-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--player-pair-color);
            left: 1px;
            bottom: 1px;
        }

        /* 投注區塊 & 統計區塊 樣式 (與原本代碼相似) */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .betting-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .betting-panel h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bet-amount-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .bet-amount-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .bet-target-display {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .target-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }

        .target-btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .target-btn[data-target="player"].active {
            background: rgba(52, 152, 219, 0.2);
            color: var(--player-color);
            border: 2px solid var(--player-color);
        }

        .target-btn[data-target="banker"].active {
            background: rgba(231, 76, 60, 0.2);
            color: var(--banker-color);
            border: 2px solid var(--banker-color);
        }

        .target-btn[data-target="tie"].active {
            background: rgba(243, 156, 18, 0.2);
            color: var(--tie-color);
            border: 2px solid var(--tie-color);
        }

        .target-btn[data-target="player_pair"].active {
            background: rgba(52, 152, 219, 0.2);
            color: var(--player-pair-color);
            border: 2px solid var(--player-pair-color);
        }

        .target-btn[data-target="banker_pair"].active {
            background: rgba(231, 76, 60, 0.2);
            color: var(--banker-pair-color);
            border: 2px solid var(--banker-pair-color);
        }

        .bet-target-full {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 個投注選項 */
            gap: 10px;
            margin-bottom: 25px;
        }

        .amount-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .amount-btn {
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .amount-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
        }

        .custom-amount {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .custom-amount input {
            flex: 1;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
            text-align: center;
        }

        .custom-amount button {
            padding: 0 25px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .bet-actions {
            display: flex;
            gap: 12px;
        }

        .bet-actions button {
            flex: 1;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .btn-clear {
            background: rgba(255, 71, 87, 0.1);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .btn-clear:hover {
            background: rgba(255, 71, 87, 0.2);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-panel h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 調整為三欄 */
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* 模態框樣式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px; /* 調整充值模態框寬度 */
            width: 90%;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* 充值模態框特有樣式 */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .payment-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .payment-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .payment-option.active {
            border-color: var(--primary-color);
            background: rgba(0, 208, 156, 0.1);
        }

        .payment-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .payment-option[data-method="crypto"] .payment-icon {
            color: #f7931a; /* Bitcoin orange */
        }

        .payment-option[data-method="bank"] .payment-icon {
            color: #3498db;
        }

        .payment-option[data-method="card"] .payment-icon {
            color: #9b59b6;
        }

        .payment-option[data-method="qr"] .payment-icon {
            color: #e67e22;
        }

        .deposit-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .deposit-message {
            text-align: center;
            color: var(--warning-color);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        /* 隱藏音樂相關的 CSS，因為重點在百家樂和充值 */
        .music-control, .music-player-ui, .music-modal {
             display: none !important;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            .header {
                flex-direction: column;
                gap: 20px;
            }
            .wallet-info {
                width: 100%;
                justify-content: space-between;
            }
            .game-area {
                order: 2;
            }
            .sidebar {
                order: 1;
                flex-direction: row;
                flex-wrap: wrap;
            }
            .betting-panel, .stats-panel, .history-panel {
                flex: 1 1 45%;
                min-width: 300px;
            }
            .big-road-container {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                flex-direction: column;
            }
            .betting-panel, .stats-panel, .history-panel {
                flex: 1 1 100%;
            }
            .cards-container {
                flex-direction: column;
                gap: 20px;
            }
            .game-table {
                padding: 20px;
            }
            .road-grid {
                grid-template-columns: repeat(40, 15px); /* 在小螢幕上縮小 */
                grid-template-rows: repeat(6, 15px);
            }
            .road-cell {
                width: 15px;
                height: 15px;
            }
            .road-circle {
                width: 12px;
                height: 12px;
                border-width: 1px;
            }
            .tie-dot, .banker-pair-dot, .player-pair-dot {
                width: 4px;
                height: 4px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-gem logo-icon"></i>
                <h1>加密百家樂</h1>
            </div>
            <div class="wallet-info">
                <div class="balance-display">
                    <div class="total-balance" id="totalBalance">100,000.00 USDT</div>
                    <div class="balance-label">當前餘額</div>
                </div>
                <button class="deposit-btn" id="openDepositModal">
                    <i class="fas fa-wallet"></i> 充值
                </button>
            </div>
        </div>
        <div class="game-area">
            <div class="game-table">
                <div class="table-content">
                    <div class="cards-container">
                        <div class="player-side">
                            <div class="side-label player-label">閒家</div>
                            <div class="cards" id="player-cards">
                                <div class="card placeholder"></div>
                                <div class="card placeholder"></div>
                            </div>
                            <div class="points-display player-points" id="player-points">0</div>
                        </div>
                        <div class="banker-side">
                            <div class="side-label banker-label">莊家</div>
                            <div class="cards" id="banker-cards">
                                <div class="card placeholder"></div>
                                <div class="card placeholder"></div>
                            </div>
                            <div class="points-display banker-points" id="banker-points">0</div>
                        </div>
                    </div>

                    <div class="result-area">
                        <div class="result-text winner-tie" id="result-text">請下注</div>
                        <div class="game-controls">
                            <button class="btn btn-secondary" id="reset-button" disabled><i class="fas fa-undo"></i> 重設</button>
                            <button class="btn btn-primary" id="deal-button" disabled><i class="fas fa-play"></i> 發牌</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="big-road-container">
                <h3><i class="fas fa-chart-line"></i> 大路牌路</h3>
                <div class="big-road">
                    <div class="road-grid" id="big-road-grid">
                        </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="betting-panel">
                <h3><i class="fas fa-money-bill-wave"></i> 投注區</h3>
                <div class="bet-amount-display">
                    <div class="bet-label">總投注</div>
                    <div class="bet-amount-value" id="current-bet-display">0.00</div>
                </div>

                <div class="bet-target-full" id="bet-targets">
                    <button class="target-btn" data-target="player">閒家 (1:1)</button>
                    <button class="target-btn" data-target="banker">莊家 (0.95:1)</button>
                    <button class="target-btn" data-target="tie">和局 (8:1)</button>
                    <button class="target-btn" data-target="player_pair">閒對 (11:1)</button>
                    <button class="target-btn" data-target="banker_pair">莊對 (11:1)</button>
                </div>

                <div class="amount-controls" id="chip-amounts">
                    <button class="amount-btn" data-amount="1">1</button>
                    <button class="amount-btn" data-amount="5">5</button>
                    <button class="amount-btn" data-amount="10">10</button>
                    <button class="amount-btn" data-amount="25">25</button>
                    <button class="amount-btn" data-amount="100">100</button>
                    <button class="amount-btn" data-amount="500">500</button>
                </div>

                <div class="bet-actions">
                    <button class="btn btn-clear" id="clear-bet-button"><i class="fas fa-times"></i> 清除</button>
                </div>
            </div>

            <div class="stats-panel">
                <h3><i class="fas fa-tachometer-alt"></i> 局數統計</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="player-wins">0</div>
                        <div class="stat-label" style="color: var(--player-color);">閒勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="banker-wins">0</div>
                        <div class="stat-label" style="color: var(--banker-color);">莊勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tie-count">0</div>
                        <div class="stat-label" style="color: var(--tie-color);">和局</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="player-pair-count">0</div>
                        <div class="stat-label" style="color: var(--player-pair-color);">閒對</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="banker-pair-count">0</div>
                        <div class="stat-label" style="color: var(--banker-pair-color);">莊對</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-rounds">0</div>
                        <div class="stat-label">總局數</div>
                    </div>
                </div>
            </div>

            <div class="history-panel">
                <h3><i class="fas fa-list-alt"></i> 局數紀錄</h3>
                <div class="history-list" id="history-list">
                    </div>
            </div>
        </div>

    </div>

    <div id="depositModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-plus-circle"></i> 資金充值</h2>
                <button class="close-modal" id="closeDepositModal">&times;</button>
            </div>
            <div class="deposit-message">
                **注意：這只是前端介面演示。實際充值需要後端與支付服務整合。**
            </div>
            <div class="payment-options" id="payment-options">
                <div class="payment-option active" data-method="crypto">
                    <i class="fab fa-bitcoin payment-icon"></i>
                    <div class="payment-name">加密貨幣 (USDT)</div>
                </div>
                <div class="payment-option" data-method="bank">
                    <i class="fas fa-university payment-icon"></i>
                    <div class="payment-name">銀行轉帳</div>
                </div>
                <div class="payment-option" data-method="card">
                    <i class="fas fa-credit-card payment-icon"></i>
                    <div class="payment-name">信用卡/金融卡</div>
                </div>
                <div class="payment-option" data-method="qr">
                    <i class="fas fa-qrcode payment-icon"></i>
                    <div class="payment-name">行動支付/QR Code</div>
                </div>
            </div>
            <input type="number" id="depositAmount" class="deposit-input" placeholder="輸入充值金額 (USDT)" min="1" step="0.01">
            <button class="btn btn-primary" id="confirmDepositBtn" style="width: 100%;">
                <i class="fas fa-check"></i> 確認充值
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM 元素獲取 ---
            const totalBalanceEl = document.getElementById('totalBalance');
            const currentBetDisplay = document.getElementById('current-bet-display');
            const betTargets = document.getElementById('bet-targets');
            const chipAmounts = document.getElementById('chip-amounts');
            const clearBetButton = document.getElementById('clear-bet-button');
            const dealButton = document.getElementById('deal-button');
            const resetButton = document.getElementById('reset-button');
            const playerCardsEl = document.getElementById('player-cards');
            const bankerCardsEl = document.getElementById('banker-cards');
            const playerPointsEl = document.getElementById('player-points');
            const bankerPointsEl = document.getElementById('banker-points');
            const resultTextEl = document.getElementById('result-text');
            const bigRoadGridEl = document.getElementById('big-road-grid');
            const historyListEl = document.getElementById('history-list');
            
            // 統計面板
            const playerWinsEl = document.getElementById('player-wins');
            const bankerWinsEl = document.getElementById('banker-wins');
            const tieCountEl = document.getElementById('tie-count');
            const playerPairCountEl = document.getElementById('player-pair-count');
            const bankerPairCountEl = document.getElementById('banker-pair-count');
            const totalRoundsEl = document.getElementById('total-rounds');

            // 充值模態框
            const depositModal = document.getElementById('depositModal');
            const openDepositModalBtn = document.getElementById('openDepositModal');
            const closeDepositModalBtn = document.getElementById('closeDepositModal');
            const depositAmountInput = document.getElementById('depositAmount');
            const confirmDepositBtn = document.getElementById('confirmDepositBtn');
            const paymentOptions = document.getElementById('payment-options');


            // --- 遊戲狀態變量 ---
            let totalBalance = 0.00;
            let currentBet = {
                player: 0,
                banker: 0,
                tie: 0,
                player_pair: 0,
                banker_pair: 0
            };
            let chipValue = 0; // 當前選擇的籌碼面額
            let gameInProgress = false;
            let currentDeck = [];
            let gameHistory = []; // 存儲遊戲結果: { winner: 'P'/'B'/'T', hasPlayerPair: bool, hasBankerPair: bool }
            let stats = {
                playerWins: 0,
                bankerWins: 0,
                tieCount: 0,
                playerPairCount: 0,
                bankerPairCount: 0,
                totalRounds: 0
            };
            let bigRoadData = []; // 大路數據結構


            // --- 充值模態框邏輯 ---
            openDepositModalBtn.onclick = () => depositModal.classList.add('active');
            closeDepositModalBtn.onclick = () => depositModal.classList.remove('active');
            window.onclick = (event) => {
                if (event.target === depositModal) {
                    depositModal.classList.remove('active');
                }
            };

            // 選擇付款方式
            paymentOptions.querySelectorAll('.payment-option').forEach(option => {
                option.onclick = () => {
                    paymentOptions.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                };
            });

            // 確認充值 (模擬)
            confirmDepositBtn.onclick = () => {
                const amount = parseFloat(depositAmountInput.value);
                if (isNaN(amount) || amount <= 0) {
                    alert('請輸入有效的充值金額！');
                    return;
                }

                // 模擬充值成功
                totalBalance += amount;
                updateBalanceDisplay();
                depositAmountInput.value = '';
                depositModal.classList.remove('active');
                alert(`成功充值 ${amount.toFixed(2)} USDT！`);
            };

            // --- UI 更新函數 ---
            function updateBalanceDisplay() {
                totalBalanceEl.textContent = `${totalBalance.toFixed(2)} USDT`;
            }

            function updateBetDisplay() {
                const totalBet = Object.values(currentBet).reduce((sum, val) => sum + val, 0);
                currentBetDisplay.textContent = totalBet.toFixed(2);

                dealButton.disabled = totalBet === 0 || gameInProgress;
                resetButton.disabled = totalBet === 0 || gameInProgress;
            }

            function updateStats() {
                playerWinsEl.textContent = stats.playerWins;
                bankerWinsEl.textContent = stats.bankerWins;
                tieCountEl.textContent = stats.tieCount;
                playerPairCountEl.textContent = stats.playerPairCount;
                bankerPairCountEl.textContent = stats.bankerPairCount;
                totalRoundsEl.textContent = stats.totalRounds;
            }

            function resetCards() {
                playerCardsEl.innerHTML = '<div class="card placeholder"></div><div class="card placeholder"></div>';
                bankerCardsEl.innerHTML = '<div class="card placeholder"></div><div class="card placeholder"></div>';
                playerPointsEl.textContent = '0';
                bankerPointsEl.textContent = '0';
                resultTextEl.textContent = '請下注';
                resultTextEl.className = 'result-text winner-tie'; // 預設為和局顏色
            }

            // --- 遊戲邏輯 - 澳門百家樂規則 ---

            /**
             * 獲取單張牌的分數。A=1, 10/J/Q/K=0, 2-9=面值。
             * @param {string} card - 牌的字串，例如 'S-A' (黑桃A)
             * @returns {number} 牌的分數
             */
            function getCardValue(card) {
                const rank = card.split('-')[1];
                if (['10', 'J', 'Q', 'K'].includes(rank)) return 0;
                if (rank === 'A') return 1;
                return parseInt(rank);
            }

            /**
             * 計算一手牌的總點數。
             * @param {string[]} hand - 牌組陣列
             * @returns {number} 總點數 (0-9)
             */
            function getHandPoints(hand) {
                const total = hand.reduce((sum, card) => sum + getCardValue(card), 0);
                return total % 10;
            }

            /**
             * 檢查是否有對子。
             * @param {string[]} hand - 牌組陣列
             * @returns {boolean} 是否有對子
             */
            function hasPair(hand) {
                if (hand.length < 2) return false;
                // 比較前兩張牌的點數
                return hand[0].split('-')[1] === hand[1].split('-')[1];
            }

            /**
             * 根據澳門百家樂規則判斷是否需要補第三張牌。
             * @param {string[]} playerHand - 閒家牌組
             * @param {string[]} bankerHand - 莊家牌組
             * @returns {Object} { playerDraw: bool, bankerDraw: bool }
             */
            function shouldDrawThirdCard(playerHand, bankerHand) {
                const pPoints = getHandPoints(playerHand);
                const bPoints = getHandPoints(bankerHand);
                const result = { playerDraw: false, bankerDraw: false };

                // 閒家和莊家任何一方獲得 8 或 9 點 (天牌)，雙方不補牌，牌局結束
                if (pPoints >= 8 || bPoints >= 8) {
                    return result;
                }

                // 閒家規則
                if (pPoints <= 5) {
                    result.playerDraw = true;
                }

                // 莊家規則
                if (!result.playerDraw) {
                    // 閒家沒有補牌（閒家點數 6 或 7）
                    if (bPoints <= 5) {
                        result.bankerDraw = true;
                    }
                } else {
                    // 閒家補牌後，莊家決定是否補牌
                    const playerThirdCardValue = getCardValue(playerHand[2]);
                    switch (bPoints) {
                        case 0:
                        case 1:
                        case 2:
                            result.bankerDraw = true;
                            break;
                        case 3:
                            // 閒家第三張牌不是 8 (牌值)
                            result.bankerDraw = (playerThirdCardValue !== 8);
                            break;
                        case 4:
                            // 閒家第三張牌是 2-7 (牌值)
                            result.bankerDraw = (playerThirdCardValue >= 2 && playerThirdCardValue <= 7);
                            break;
                        case 5:
                            // 閒家第三張牌是 4-7 (牌值)
                            result.bankerDraw = (playerThirdCardValue >= 4 && playerThirdCardValue <= 7);
                            break;
                        case 6:
                            // 閒家第三張牌是 6 或 7 (牌值)
                            result.bankerDraw = (playerThirdCardValue === 6 || playerThirdCardValue === 7);
                            break;
                        case 7:
                            result.bankerDraw = false;
                            break;
                    }
                }
                return result;
            }

            // --- 牌組和發牌邏輯 ---

            /**
             * 建立一副完整的牌組 (8 副牌)。
             */
            function createDeck() {
                const suits = ['S', 'H', 'D', 'C']; // Spades, Hearts, Diamonds, Clubs
                const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                let deck = [];
                for (let i = 0; i < 8; i++) { // 8 副牌
                    for (const suit of suits) {
                        for (const rank of ranks) {
                            deck.push(`${suit}-${rank}`);
                        }
                    }
                }
                return shuffleDeck(deck);
            }

            /**
             * 洗牌。
             */
            function shuffleDeck(deck) {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                return deck;
            }

            // 初始化牌組
            function initializeDeck() {
                currentDeck = createDeck();
            }
            initializeDeck();


            // --- 牌路邏輯：大路生成 ---
            
            /**
             * 將遊戲結果轉換為大路格式。
             * @param {string} winner - 'P' (Player), 'B' (Banker), 'T' (Tie)
             * @param {boolean} pPair - 閒對
             * @param {boolean} bPair - 莊對
             */
            function updateBigRoad(winner, pPair, bPair) {
                // 如果是和局，只在上一局結果上標記，不開新列
                if (winner === 'T') {
                    if (bigRoadData.length > 0) {
                        // 增加和局計數和對子標記
                        const lastResult = bigRoadData[bigRoadData.length - 1];
                        lastResult.ties++;
                        if (pPair) lastResult.pPair = true;
                        if (bPair) lastResult.bPair = true;
                    }
                    return; // 和局不新增列
                }

                const newWinner = winner; // 'P' or 'B'
                let newColumn = false; // 是否需要開新列

                if (bigRoadData.length === 0) {
                    // 第一局必須開新列
                    newColumn = true;
                } else {
                    const lastResult = bigRoadData[bigRoadData.length - 1];
                    const lastWinner = lastResult.type;

                    if (lastWinner === newWinner) {
                        // 連勝：在同一列向下新增
                        newColumn = false;
                    } else {
                        // 換邊：開新列
                        newColumn = true;
                    }
                }

                if (newColumn) {
                    bigRoadData.push({
                        type: newWinner, // 'P' or 'B'
                        results: [{ p: pPair, b: bPair, t: 0 }],
                        ties: 0,
                        pPair: pPair,
                        bPair: bPair
                    });
                } else {
                    // 在當前列的最後一個結果中，新增一個結果
                    const lastResult = bigRoadData[bigRoadData.length - 1];
                    lastResult.results.push({ p: pPair, b: bPair, t: 0 });
                    if (pPair) lastResult.pPair = true;
                    if (bPair) lastResult.bPair = true;
                }
            }


            /**
             * 渲染大路網格。
             */
            function renderBigRoad() {
                bigRoadGridEl.innerHTML = ''; // 清空網格
                const numRows = 6;
                const numCols = 60; // 顯示 60 欄

                // 1. 初始化網格單元格
                const cells = Array.from({ length: numRows }, () => Array(numCols).fill(null));

                let currentColumn = 0;

                // 2. 填充大路數據
                for (const columnData of bigRoadData) {
                    let currentRow = 0;
                    
                    // 遍歷該連勝（列）中的所有結果
                    for (const result of columnData.results) {
                        if (currentColumn >= numCols) break; // 超出顯示範圍

                        // 確保不超過 6 行
                        if (currentRow < numRows) {
                            cells[currentRow][currentColumn] = {
                                type: columnData.type,
                                hasTie: columnData.ties > 0 && currentRow === columnData.results.length - 1, // 只有連勝尾部標記總和局
                                pPair: result.p,
                                bPair: result.b,
                                tieCount: columnData.ties,
                                isColumnStart: currentRow === 0
                            };
                            currentRow++;
                        } else {
                            // 數據下移 ('Dragon') - 只處理該列的第一行
                            // 從第二行開始的數據，只要行數超過 6，就平移到下一列的第一行（這是複雜的牌路邏輯，這裡僅簡單表示下移）
                            let overflowRow = currentRow;
                            let overflowCol = currentColumn;
                            
                            while (overflowRow < columnData.results.length) {
                                overflowCol++;
                                if (overflowCol >= numCols) break; // 超出顯示範圍
                                cells[numRows - 1][overflowCol] = {
                                    type: columnData.type,
                                    hasTie: false, // 龍尾巴不標記和
                                    pPair: columnData.results[overflowRow].p,
                                    bPair: columnData.results[overflowRow].b,
                                    tieCount: 0,
                                    isColumnStart: false
                                };
                                overflowRow++;
                            }
                        }
                    }

                    // 只有在當前列沒有溢出的情況下，才移動到下一列
                    if (currentRow <= numRows) {
                        currentColumn++;
                    }
                    
                }

                // 3. 渲染網格
                for (let r = 0; r < numRows; r++) {
                    for (let c = 0; c < numCols; c++) {
                        const cellData = cells[r][c];
                        const cellDiv = document.createElement('div');
                        cellDiv.classList.add('road-cell');
                        
                        if (cellData) {
                            const circleDiv = document.createElement('div');
                            circleDiv.classList.add('road-circle');
                            
                            if (cellData.type === 'B') {
                                circleDiv.classList.add('banker-road-circle');
                            } else if (cellData.type === 'P') {
                                circleDiv.classList.add('player-road-circle');
                            }
                            
                            // 標記和局
                            if (cellData.hasTie && cellData.tieCount > 0) {
                                const tieDot = document.createElement('div');
                                tieDot.classList.add('tie-dot');
                                cellDiv.appendChild(tieDot);
                                // 在和局點上顯示和局計數（可選）
                                // circleDiv.textContent = cellData.tieCount; 
                            }
                            
                            // 標記對子
                            if (cellData.pPair) {
                                const ppDot = document.createElement('div');
                                ppDot.classList.add('player-pair-dot');
                                cellDiv.appendChild(ppDot);
                            }
                            if (cellData.bPair) {
                                const bpDot = document.createElement('div');
                                bpDot.classList.add('banker-pair-dot');
                                cellDiv.appendChild(bpDot);
                            }

                            cellDiv.appendChild(circleDiv);
                        }
                        
                        bigRoadGridEl.appendChild(cellDiv);
                    }
                }
                
                // 滾動到最右邊顯示最新的結果
                bigRoadGridEl.parentElement.scrollLeft = bigRoadGridEl.scrollWidth;
            }

            // --- 遊戲流程控制 ---
            
            /**
             * 處理單局遊戲流程。
             */
            async function dealCards() {
                if (Object.values(currentBet).every(bet => bet === 0)) {
                    alert('請先下注！');
                    return;
                }
                gameInProgress = true;
                dealButton.disabled = true;
                resetButton.disabled = true;
                clearBetButton.disabled = true;

                // 1. 扣除總餘額
                const totalBet = Object.values(currentBet).reduce((sum, val) => sum + val, 0);
                totalBalance -= totalBet;
                updateBalanceDisplay();

                // 2. 檢查牌數，不足則重新洗牌 (假設剩餘 20 張牌時重新洗牌)
                if (currentDeck.length < 20) {
                    initializeDeck();
                    console.log('牌組重洗，新牌數:', currentDeck.length);
                }

                // 3. 發首四張牌
                let pHand = [currentDeck.pop(), currentDeck.pop()]; // P1, B1
                let bHand = [currentDeck.pop(), currentDeck.pop()]; // P2, B2 (發牌順序 P1, B1, P2, B2)
                
                // 修正發牌順序：P1, B1, P2, B2
                pHand = [pHand[0], bHand[0]];
                bHand = [pHand[1], bHand[1]];
                
                pHand = [currentDeck.pop(), currentDeck.pop()]; // P1, P2
                bHand = [currentDeck.pop(), currentDeck.pop()]; // B1, B2

                // 延遲顯示卡牌
                const renderCard = (hand, element) => {
                    element.innerHTML = '';
                    hand.forEach((card, index) => {
                        const [suit, rank] = card.split('-');
                        const colorClass = ['H', 'D'].includes(suit) ? 'red' : 'black';
                        const suitIcon = { 'S': '♠', 'H': '♥', 'D': '♦', 'C': '♣' }[suit];
                        const cardHtml = `
                            <div class="card flipped ${colorClass}">
                                <div class="card-back"><i class="fas fa-question-circle"></i></div>
                                <div class="card-front">
                                    <div style="font-size: 1.5rem; position: absolute; top: 10px; left: 10px;">${rank} ${suitIcon}</div>
                                    <div style="font-size: 4rem;">${rank}</div>
                                    <div style="font-size: 1.5rem; position: absolute; bottom: 10px; right: 10px; transform: rotate(180deg);">${rank} ${suitIcon}</div>
                                </div>
                            </div>
                        `;
                        element.innerHTML += cardHtml;
                    });
                };
                
                renderCard(pHand, playerCardsEl);
                renderCard(bHand, bankerCardsEl);

                await new Promise(r => setTimeout(r, 1000));
                
                // 翻開卡牌 (這裡簡化，直接顯示點數)
                const flipCards = (hand, element) => {
                    const cards = element.querySelectorAll('.card');
                    cards.forEach(card => card.classList.remove('flipped'));
                    // 更新點數
                    if (hand === pHand) playerPointsEl.textContent = getHandPoints(pHand);
                    if (hand === bHand) bankerPointsEl.textContent = getHandPoints(bHand);
                }
                
                flipCards(pHand, playerCardsEl);
                flipCards(bHand, bankerCardsEl);

                await new Promise(r => setTimeout(r, 1500));


                // 4. 判斷是否補牌
                const drawRules = shouldDrawThirdCard(pHand, bHand);

                let pCard3 = null;
                let bCard3 = null;

                if (drawRules.playerDraw) {
                    pCard3 = currentDeck.pop();
                    pHand.push(pCard3);
                    renderCard(pHand, playerCardsEl);
                    await new Promise(r => setTimeout(r, 1000));
                    flipCards(pHand, playerCardsEl); // 刷新閒家點數
                    await new Promise(r => setTimeout(r, 500));
                }

                if (drawRules.bankerDraw) {
                    bCard3 = currentDeck.pop();
                    bHand.push(bCard3);
                    renderCard(bHand, bankerCardsEl);
                    await new Promise(r => setTimeout(r, 1000));
                    flipCards(bHand, bankerCardsEl); // 刷新莊家點數
                    await new Promise(r => setTimeout(r, 500));
                }


                // 5. 判斷結果和派彩
                const pPoints = getHandPoints(pHand);
                const bPoints = getHandPoints(bHand);
                const pPair = hasPair(pHand);
                const bPair = hasPair(bHand);

                let winner = '';
                let winColorClass = '';
                if (pPoints > bPoints) {
                    winner = 'Player';
                    winColorClass = 'winner-player';
                    stats.playerWins++;
                } else if (bPoints > pPoints) {
                    winner = 'Banker';
                    winColorClass = 'winner-banker';
                    stats.bankerWins++;
                } else {
                    winner = 'Tie';
                    winColorClass = 'winner-tie';
                    stats.tieCount++;
                }
                
                // 更新統計數據中的對子數
                if (pPair) stats.playerPairCount++;
                if (bPair) stats.bankerPairCount++;
                stats.totalRounds++;
                updateStats();

                resultTextEl.textContent = `${winner.toUpperCase()} 勝！ (${pPoints} - ${bPoints})`;
                resultTextEl.className = `result-text ${winColorClass}`;

                // 6. 派彩
                let winAmount = 0;

                // 閒家/莊家/和局
                if (winner === 'Player') {
                    winAmount += currentBet.player * 2.0; // 1:1
                } else if (winner === 'Banker') {
                    // 澳門百家樂莊家贏扣 5% 佣金
                    winAmount += currentBet.banker * (1 + 0.95); // 0.95:1
                } else { // Tie
                    winAmount += currentBet.player;
                    winAmount += currentBet.banker;
                    winAmount += currentBet.tie * 9.0; // 8:1 (賠 9 倍，贏 8)
                }
                
                // 對子派彩
                if (pPair && currentBet.player_pair > 0) {
                    winAmount += currentBet.player_pair * 12.0; // 11:1 (賠 12 倍，贏 11)
                    if (winner === 'Player') resultTextEl.textContent += ' (閒對)';
                }
                if (bPair && currentBet.banker_pair > 0) {
                    winAmount += currentBet.banker_pair * 12.0; // 11:1 (賠 12 倍，贏 11)
                    if (winner === 'Banker') resultTextEl.textContent += ' (莊對)';
                }

                totalBalance += winAmount;
                updateBalanceDisplay();

                // 7. 記錄歷史和牌路
                const historyResult = {
                    winner: winner[0],
                    player: pPoints,
                    banker: bPoints,
                    pPair: pPair,
                    bPair: bPair,
                    totalBet: totalBet,
                    winAmount: winAmount - totalBet // 淨贏利
                };
                gameHistory.push(historyResult);
                
                // 更新大路
                updateBigRoad(historyResult.winner, historyResult.pPair, historyResult.bPair);
                renderBigRoad();

                // 更新歷史列表
                renderHistoryList(historyResult);

                // 8. 重設投注和狀態
                currentBet = { player: 0, banker: 0, tie: 0, player_pair: 0, banker_pair: 0 };
                updateBetDisplay();

                gameInProgress = false;
                dealButton.disabled = true;
                resetButton.disabled = false; // 允許重設盤口
                clearBetButton.disabled = false;
            }

            // 渲染單局歷史
            function renderHistoryList(result) {
                const item = document.createElement('div');
                let resultClass = '';
                if (result.winner === 'P') resultClass = 'history-player';
                else if (result.winner === 'B') resultClass = 'history-banker';
                else resultClass = 'history-tie';
                
                let winLossClass = result.winAmount >= 0 ? 'color: var(--primary-color);' : 'color: var(--danger-color);';
                
                const pairText = (result.pPair ? '閒對 ' : '') + (result.bPair ? '莊對' : '');

                item.classList.add('history-item', resultClass);
                item.innerHTML = `
                    <div>局數 #${stats.totalRounds} (${result.player}-${result.banker})</div>
                    <div>
                        <span style="font-weight: bold;">${result.winner === 'P' ? '閒勝' : result.winner === 'B' ? '莊勝' : '和局'}</span>
                        ${pairText ? `(${pairText})` : ''}
                    </div>
                    <div style="${winLossClass}">${result.winAmount >= 0 ? '+' : ''}${result.winAmount.toFixed(2)}</div>
                `;
                historyListEl.prepend(item); // 最新結果在最上面
            }


            // --- 事件監聽器 ---

            // 選擇籌碼面額
            chipAmounts.addEventListener('click', (e) => {
                if (e.target.classList.contains('amount-btn')) {
                    chipAmounts.querySelectorAll('.amount-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    chipValue = parseFloat(e.target.dataset.amount);
                }
            });
            // 預設選擇第一個籌碼
            chipAmounts.querySelector('.amount-btn').classList.add('active');

            // 選擇投注目標
            betTargets.addEventListener('click', (e) => {
                const targetBtn = e.target.closest('.target-btn');
                if (targetBtn && !gameInProgress) {
                    const target = targetBtn.dataset.target;
                    
                    if (totalBalance < chipValue) {
                        alert('餘額不足，請充值或選擇較小籌碼。');
                        return;
                    }

                    // 更新投注金額和總餘額
                    currentBet[target] += chipValue;
                    totalBalance -= chipValue; // 先扣除籌碼
                    
                    updateBetDisplay();
                    updateBalanceDisplay();
                    
                    // 簡單標記選中的投注目標 (可以改為更複雜的籌碼堆疊 UI)
                    targetBtn.textContent = `${targetBtn.textContent.split('(')[0].trim()} (${currentBet[target].toFixed(2)})`;

                    // 啟用發牌按鈕
                    dealButton.disabled = false;
                }
            });

            // 清除投注
            clearBetButton.addEventListener('click', () => {
                if (gameInProgress) return;
                
                const totalBet = Object.values(currentBet).reduce((sum, val) => sum + val, 0);
                totalBalance += totalBet; // 返還所有投注金額
                updateBalanceDisplay();

                currentBet = { player: 0, banker: 0, tie: 0, player_pair: 0, banker_pair: 0 };
                updateBetDisplay();
                
                // 重置按鈕文字
                betTargets.querySelectorAll('.target-btn').forEach(btn => {
                    const target = btn.dataset.target;
                    const defaultText = {
                        'player': '閒家 (1:1)',
                        'banker': '莊家 (0.95:1)',
                        'tie': '和局 (8:1)',
                        'player_pair': '閒對 (11:1)',
                        'banker_pair': '莊對 (11:1)'
                    };
                    btn.textContent = defaultText[target];
                });
            });

            // 發牌按鈕
            dealButton.addEventListener('click', dealCards);
            
            // 重設按鈕
            resetButton.addEventListener('click', () => {
                resetCards();
                // 這裡只清空牌桌，不影響投注和歷史記錄
                dealButton.disabled = Object.values(currentBet).every(bet => bet === 0);
                resetButton.disabled = true;
            });


            // --- 初始設置 ---
            updateBalanceDisplay();
            updateBetDisplay();
            updateStats();
            renderBigRoad(); // 初始化牌路網格

        });
    </script>
</body>
</html>
