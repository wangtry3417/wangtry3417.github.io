<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密百家樂 | Crypto Baccarat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00d09c;
            --secondary-color: #00a8ff;
            --danger-color: #ff4757;
            --warning-color: #ffa502;
            --dark-bg: #0f1525;
            --darker-bg: #0a0e1a;
            --card-bg: #1a2238;
            --text-color: #ffffff;
            --text-secondary: #8a94ad;
            --player-color: #3498db;
            --banker-color: #e74c3c;
            --tie-color: #f39c12;
            --road-red: #e74c3c;
            --road-blue: #3498db;
            --road-green: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 25px;
        }

        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: var(--primary-color);
        }

        .sound-control {
            display: flex;
            gap: 10px;
        }

        .sound-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .sound-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .balance-display {
            text-align: right;
        }

        .total-balance {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .deposit-btn {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deposit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 208, 156, 0.3);
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .game-table {
            background: linear-gradient(145deg, #1a2238, #141b2d);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .table-design {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 208, 156, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 168, 255, 0.1) 0%, transparent 50%);
            z-index: 1;
        }

        .table-content {
            position: relative;
            z-index: 2;
        }

        .cards-container {
            display: flex;
            justify-content: space-around;
            margin: 40px 0;
            gap: 50px;
        }

        .player-side, .banker-side {
            text-align: center;
            flex: 1;
            padding: 30px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
            position: relative;
        }

        .player-side.active, .banker-side.active {
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .side-label {
            font-size: 1.8rem;
            margin-bottom: 30px;
            padding: 15px 40px;
            border-radius: 50px;
            display: inline-block;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            border: 3px solid;
            position: relative;
            overflow: hidden;
        }

        .player-label {
            background: rgba(52, 152, 219, 0.1);
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-label {
            background: rgba(231, 76, 60, 0.1);
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            min-height: 180px;
            align-items: center;
        }

        .card {
            width: 120px;
            height: 170px;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            color: #1a2238;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            cursor: pointer;
            perspective: 1000px;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            transform: rotateY(0deg);
        }

        .card-back {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transform: rotateY(180deg);
            color: white;
            font-size: 2rem;
        }

        .card.red {
            color: #e74c3c;
        }

        .card.black {
            color: #2c3e50;
        }

        .card.placeholder {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .card.special-card .card-front {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }

        .points-display {
            font-size: 2.8rem;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            display: inline-block;
            min-width: 200px;
            border: 3px solid;
        }

        .player-points {
            color: var(--player-color);
            border-color: var(--player-color);
        }

        .banker-points {
            color: var(--banker-color);
            border-color: var(--banker-color);
        }

        .result-area {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .result-text {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .winner-player {
            color: var(--player-color);
            text-shadow: 0 0 30px rgba(52, 152, 219, 0.7);
        }

        .winner-banker {
            color: var(--banker-color);
            text-shadow: 0 0 30px rgba(231, 76, 60, 0.7);
        }

        .winner-tie {
            color: var(--tie-color);
            text-shadow: 0 0 30px rgba(243, 156, 18, 0.7);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 30px;
        }

        .btn {
            padding: 20px 50px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 10px 25px rgba(0, 208, 156, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 208, 156, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .big-road-container {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .road-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .road-header h3 {
            font-size: 1.8rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .road-controls {
            display: flex;
            gap: 10px;
        }

        .road-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .road-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .big-road {
            background: #0a0e1a;
            border-radius: 15px;
            padding: 20px;
            overflow: auto;
        }

        .road-table {
            display: grid;
            grid-template-columns: repeat(40, 24px);
            grid-template-rows: repeat(6, 24px);
            gap: 2px;
            min-width: 1000px;
        }

        .road-cell {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            position: relative;
        }

        .player-road {
            background: var(--road-blue);
            color: white;
        }

        .banker-road {
            background: var(--road-red);
            color: white;
        }

        .tie-road {
            background: var(--road-green);
            color: white;
            border: 2px solid white;
        }

        .road-dragon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8px;
            font-weight: bold;
        }

        .empty-road {
            background: rgba(255, 255, 255, 0.05);
        }

        .road-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 0 10px;
        }

        .road-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .road-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .betting-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .betting-panel h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bet-amount-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .bet-amount-label {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .bet-amount-value {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .bet-target-display {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .target-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }

        .target-btn.active {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .target-btn[data-target="player"].active {
            background: rgba(52, 152, 219, 0.2);
            color: var(--player-color);
            border: 3px solid var(--player-color);
        }

        .target-btn[data-target="banker"].active {
            background: rgba(231, 76, 60, 0.2);
            color: var(--banker-color);
            border: 3px solid var(--banker-color);
        }

        .target-btn[data-target="tie"].active {
            background: rgba(243, 156, 18, 0.2);
            color: var(--tie-color);
            border: 3px solid var(--tie-color);
        }

        .amount-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .amount-btn {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
        }

        .amount-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .amount-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
        }

        .custom-amount {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .custom-amount input {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-color);
            font-size: 1.2rem;
            text-align: center;
        }

        .custom-amount button {
            padding: 0 30px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .custom-amount button:hover {
            transform: translateY(-2px);
        }

        .bet-actions {
            display: flex;
            gap: 15px;
        }

        .bet-actions button {
            flex: 1;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-clear {
            background: rgba(255, 71, 87, 0.1);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .btn-clear:hover {
            background: rgba(255, 71, 87, 0.2);
            transform: translateY(-2px);
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stats-panel h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .history-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .history-panel h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            padding: 10px 0;
            z-index: 1;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border-left: 5px solid;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .history-player {
            border-left-color: var(--player-color);
        }

        .history-banker {
            border-left-color: var(--banker-color);
        }

        .history-tie {
            border-left-color: var(--tie-color);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .history-round {
            font-weight: bold;
            color: var(--text-color);
        }

        .history-result {
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .history-amount {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .profit-positive {
            color: var(--primary-color);
        }

        .profit-negative {
            color: var(--danger-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 2.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--text-color);
        }

        .crypto-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .crypto-option {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .crypto-option:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }

        .crypto-option.active {
            border-color: var(--primary-color);
            background: rgba(0, 208, 156, 0.1);
        }

        .crypto-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .crypto-icon.btc {
            background: rgba(247, 147, 26, 0.1);
            color: #f7931a;
        }

        .crypto-icon.eth {
            background: rgba(105, 119, 134, 0.1);
            color: #697786;
        }

        .crypto-icon.usdt {
            background: rgba(38, 161, 123, 0.1);
            color: #26a17b;
        }

        .crypto-info {
            flex: 1;
        }

        .crypto-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .crypto-symbol {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .deposit-amount {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .deposit-amount input {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-color);
            font-size: 1.3rem;
            text-align: center;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .quick-amount {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-color);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-amount:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
        }

        .modal-actions button {
            flex: 1;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-confirm {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 208, 156, 0.3);
        }

        @keyframes cardDeal {
            0% {
                transform: translateY(-100px) rotateY(0deg);
                opacity: 0;
            }
            100% {
                transform: translateY(0) rotateY(360deg);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes winGlow {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
        }

        @keyframes roadEntry {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .card-dealing {
            animation: cardDeal 0.5s ease forwards;
        }

        .winning-animation {
            animation: pulse 0.5s ease 3, winGlow 1s ease infinite;
        }

        .road-entry {
            animation: roadEntry 0.3s ease forwards;
        }

        .dragon-tail {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid currentColor;
            box-sizing: border-box;
        }

        .bead-road {
            display: grid;
            grid-template-columns: repeat(40, 12px);
            grid-template-rows: repeat(6, 12px);
            gap: 1px;
            margin-top: 20px;
        }

        .bead-cell {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .wallet-info {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .cards-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .player-side, .banker-side {
                width: 100%;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .bet-target-display {
                flex-direction: column;
            }
            
            .amount-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .road-table {
                grid-template-columns: repeat(20, 24px);
                min-width: 500px;
            }
        }
    </style>
</head>
<body>
    <!-- 音效元素 -->
    <audio id="backgroundMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3" type="audio/mpeg">
    </audio>
    <audio id="cardSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-shuffle-2467.mp3" type="audio/mpeg">
    </audio>
    <audio id="dealSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-card-game-tap-1990.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="loseSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="chipSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-casino-chips-handling-1249.mp3" type="audio/mpeg">
    </audio>
    <audio id="depositSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-money-bag-drop-1998.mp3" type="audio/mpeg">
    </audio>

    <!-- 存款模態框 -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-wallet"></i> 加密貨幣存款
                </div>
                <button class="close-modal" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="crypto-options">
                <div class="crypto-option active" data-crypto="BTC">
                    <div class="crypto-icon btc">
                        <i class="fab fa-bitcoin"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">比特幣</div>
                        <div class="crypto-symbol">BTC</div>
                    </div>
                    <div class="crypto-check">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                
                <div class="crypto-option" data-crypto="ETH">
                    <div class="crypto-icon eth">
                        <i class="fab fa-ethereum"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">以太坊</div>
                        <div class="crypto-symbol">ETH</div>
                    </div>
                    <div class="crypto-check">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                
                <div class="crypto-option" data-crypto="USDT">
                    <div class="crypto-icon usdt">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">泰達幣</div>
                        <div class="crypto-symbol">USDT</div>
                    </div>
                    <div class="crypto-check">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
            
            <div class="deposit-amount">
                <input type="number" id="depositAmount" placeholder="輸入存款金額" min="0" step="0.01">
                <div class="quick-amounts">
                    <div class="quick-amount" data-amount="100">100 USDT</div>
                    <div class="quick-amount" data-amount="500">500 USDT</div>
                    <div class="quick-amount" data-amount="1000">1,000 USDT</div>
                    <div class="quick-amount" data-amount="5000">5,000 USDT</div>
                    <div class="quick-amount" data-amount="10000">10,000 USDT</div>
                    <div class="quick-amount" data-amount="50000">50,000 USDT</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-confirm" id="confirmDeposit">
                    <i class="fas fa-check"></i> 確認存款
                </button>
                <button class="btn-secondary" id="cancelDeposit">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 主遊戲介面 -->
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-dice"></i>
                </div>
                <h1>加密百家樂</h1>
            </div>
            
            <div class="sound-control">
                <button class="sound-btn" id="musicBtn" title="背景音樂">
                    <i class="fas fa-music"></i>
                </button>
                <button class="sound-btn active" id="soundBtn" title="音效">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>
            
            <div class="wallet-info">
                <div class="balance-display">
                    <div class="total-balance" id="totalBalance">0.00</div>
                    <div class="balance-label">總餘額 (USDT)</div>
                </div>
                <button class="deposit-btn" id="openDeposit">
                    <i class="fas fa-plus-circle"></i>
                    存款
                </button>
            </div>
        </div>

        <div class="game-area">
            <div class="game-table">
                <div class="table-design"></div>
                <div class="table-content">
                    <div class="cards-container">
                        <div class="player-side" id="playerSide">
                            <div class="side-label player-label">玩家 PLAYER</div>
                            <div class="cards" id="playerCards">
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="points-display player-points" id="playerPoints">0</div>
                        </div>
                        
                        <div class="banker-side" id="bankerSide">
                            <div class="side-label banker-label">莊家 BANKER</div>
                            <div class="cards" id="bankerCards">
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-question"></i>
                                    </div>
                                </div>
                                <div class="card placeholder">
                                    <div class="card-front"></div>
                                    <div class="card-back">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="points-display banker-points" id="bankerPoints">0</div>
                        </div>
                    </div>
                    
                    <div class="result-area">
                        <div class="result-text" id="resultText">請下注後開始遊戲</div>
                    </div>
                    
                    <div class="game-controls">
                        <button class="btn btn-primary" id="dealBtn">
                            <i class="fas fa-play"></i>
                            發牌
                        </button>
                        <button class="btn btn-secondary" id="newRoundBtn">
                            <i class="fas fa-redo"></i>
                            新一局
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="big-road-container">
                <div class="road-header">
                    <h3><i class="fas fa-chart-line"></i> 大路圖</h3>
                    <div class="road-controls">
                        <button class="road-btn" id="clearRoad">清除</button>
                        <button class="road-btn" id="toggleRoad">切換</button>
                    </div>
                </div>
                <div class="big-road">
                    <div class="road-table" id="roadTable">
                        <!-- 大路圖動態生成 -->
                    </div>
                    <div class="road-labels">
                        <div class="road-label">
                            <div class="road-color" style="background: var(--road-blue);"></div>
                            <span>玩家 (P)</span>
                        </div>
                        <div class="road-label">
                            <div class="road-color" style="background: var(--road-red);"></div>
                            <span>莊家 (B)</span>
                        </div>
                        <div class="road-label">
                            <div class="road-color" style="background: var(--road-green); border: 2px solid white;"></div>
                            <span>和局 (T)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="betting-panel">
                <h3><i class="fas fa-coins"></i> 下注控制</h3>
                
                <div class="bet-amount-display">
                    <div class="bet-amount-label">下注金額</div>
                    <div class="bet-amount-value" id="betAmountValue">0</div>
                    <div class="bet-target-label" id="betTargetLabel">尚未選擇下注目標</div>
                </div>
                
                <div class="bet-target-display">
                    <button class="target-btn" data-target="player">
                        <i class="fas fa-user"></i>
                        <span>玩家</span>
                        <small>賠率 1.95</small>
                    </button>
                    <button class="target-btn" data-target="banker">
                        <i class="fas fa-landmark"></i>
                        <span>莊家</span>
                        <small>賠率 1.95</small>
                    </button>
                    <button class="target-btn" data-target="tie">
                        <i class="fas fa-handshake"></i>
                        <span>和局</span>
                        <small>賠率 8.00</small>
                    </button>
                </div>
                
                <div class="amount-controls">
                    <button class="amount-btn" data-amount="10">10</button>
                    <button class="amount-btn" data-amount="50">50</button>
                    <button class="amount-btn" data-amount="100">100</button>
                    <button class="amount-btn" data-amount="500">500</button>
                    <button class="amount-btn" data-amount="1000">1,000</button>
                    <button class="amount-btn" data-amount="5000">5,000</button>
                </div>
                
                <div class="custom-amount">
                    <input type="number" id="customAmount" placeholder="自訂金額" min="0">
                    <button id="setCustomAmount">設定</button>
                </div>
                
                <div class="bet-actions">
                    <button class="btn-clear" id="clearBet">
                        <i class="fas fa-times"></i>
                        清除
                    </button>
                    <button class="btn-confirm" id="placeBet">
                        <i class="fas fa-check"></i>
                        確認下注
                    </button>
                </div>
            </div>
            
            <div class="stats-panel">
                <h3><i class="fas fa-chart-bar"></i> 遊戲統計</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalRounds">0</div>
                        <div class="stat-label">總局數</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="playerWins">0</div>
                        <div class="stat-label">玩家勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bankerWins">0</div>
                        <div class="stat-label">莊家勝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tieGames">0</div>
                        <div class="stat-label">和局</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">勝率</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalProfit">0</div>
                        <div class="stat-label">總盈利</div>
                    </div>
                </div>
            </div>
            
            <div class="history-panel">
                <h3><i class="fas fa-history"></i> 交易紀錄</h3>
                <div class="history-list" id="historyList">
                    <div class="history-item" style="text-align: center; color: var(--text-secondary); padding: 30px;">
                        尚未有交易紀錄
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 遊戲狀態
        const gameState = {
            balance: 0,  // USDT餘額
            currentBet: 0,
            currentBetTarget: null,
            isGameActive: false,
            isBetPlaced: false,
            selectedCrypto: 'BTC',
            depositAmount: 0,
            
            // 遊戲統計
            totalRounds: 0,
            playerWins: 0,
            bankerWins: 0,
            tieGames: 0,
            totalProfit: 0,
            
            // 遊戲歷史
            gameHistory: [],
            bigRoad: [],
            roadType: 'big', // 'big', 'bead', 'cockroach'
            
            // 當前遊戲
            playerCards: [null, null, null],
            bankerCards: [null, null, null],
            playerPoints: 0,
            bankerPoints: 0,
            gameResult: null,
            
            // 音效設置
            soundEnabled: true,
            musicEnabled: false
        };

        // 音效元素
        const audioElements = {
            backgroundMusic: document.getElementById('backgroundMusic'),
            cardSound: document.getElementById('cardSound'),
            dealSound: document.getElementById('dealSound'),
            winSound: document.getElementById('winSound'),
            loseSound: document.getElementById('loseSound'),
            chipSound: document.getElementById('chipSound'),
            depositSound: document.getElementById('depositSound')
        };

        // DOM元素
        const elements = {
            // 音效控制
            musicBtn: document.getElementById('musicBtn'),
            soundBtn: document.getElementById('soundBtn'),
            
            // 餘額顯示
            totalBalance: document.getElementById('totalBalance'),
            
            // 存款相關
            depositModal: document.getElementById('depositModal'),
            openDepositBtn: document.getElementById('openDeposit'),
            closeModalBtn: document.getElementById('closeModal'),
            cancelDepositBtn: document.getElementById('cancelDeposit'),
            confirmDepositBtn: document.getElementById('confirmDeposit'),
            depositAmountInput: document.getElementById('depositAmount'),
            cryptoOptions: document.querySelectorAll('.crypto-option'),
            quickAmounts: document.querySelectorAll('.quick-amount'),
            
            // 遊戲相關
            playerSide: document.getElementById('playerSide'),
            bankerSide: document.getElementById('bankerSide'),
            playerCardsContainer: document.getElementById('playerCards'),
            bankerCardsContainer: document.getElementById('bankerCards'),
            playerPointsElement: document.getElementById('playerPoints'),
            bankerPointsElement: document.getElementById('bankerPoints'),
            resultText: document.getElementById('resultText'),
            dealBtn: document.getElementById('dealBtn'),
            newRoundBtn: document.getElementById('newRoundBtn'),
            
            // 大路圖相關
            roadTable: document.getElementById('roadTable'),
            clearRoadBtn: document.getElementById('clearRoad'),
            toggleRoadBtn: document.getElementById('toggleRoad'),
            
            // 下注相關
            betAmountValue: document.getElementById('betAmountValue'),
            betTargetLabel: document.getElementById('betTargetLabel'),
            targetButtons: document.querySelectorAll('.target-btn'),
            amountButtons: document.querySelectorAll('.amount-btn'),
            customAmountInput: document.getElementById('customAmount'),
            setCustomAmountBtn: document.getElementById('setCustomAmount'),
            clearBetBtn: document.getElementById('clearBet'),
            placeBetBtn: document.getElementById('placeBet'),
            
            // 統計相關
            totalRoundsElement: document.getElementById('totalRounds'),
            playerWinsElement: document.getElementById('playerWins'),
            bankerWinsElement: document.getElementById('bankerWins'),
            tieGamesElement: document.getElementById('tieGames'),
            winRateElement: document.getElementById('winRate'),
            totalProfitElement: document.getElementById('totalProfit'),
            
            // 歷史相關
            historyList: document.getElementById('historyList')
        };

        // 卡片牌組 (標準52張牌)
        const standardDeck = [];
        const suits = ['♠', '♥', '♦', '♣'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        // 創建標準牌組
        suits.forEach(suit => {
            ranks.forEach(rank => {
                standardDeck.push({
                    rank: rank,
                    suit: suit,
                    value: getCardValue(rank)
                });
            });
        });

        let currentDeck = [...standardDeck];
        let deckIndex = 0;

        // 初始化遊戲
        function initializeGame() {
            shuffleDeck();
            updateUI();
            initializeBigRoad();
            initializeEventListeners();
            
            // 初始提示
            if (gameState.balance === 0) {
                elements.resultText.textContent = '請先存款以開始遊戲';
                elements.resultText.style.color = 'var(--warning-color)';
            }
            
            // 設置音樂音量
            audioElements.backgroundMusic.volume = 0.3;
            audioElements.cardSound.volume = 0.5;
            audioElements.dealSound.volume = 0.5;
            audioElements.winSound.volume = 0.7;
            audioElements.loseSound.volume = 0.7;
            audioElements.chipSound.volume = 0.6;
            audioElements.depositSound.volume = 0.7;
        }

        // 初始化事件監聽器
        function initializeEventListeners() {
            // 音效控制
            elements.musicBtn.addEventListener('click', toggleMusic);
            elements.soundBtn.addEventListener('click', toggleSound);
            
            // 存款相關
            elements.openDepositBtn.addEventListener('click', openDepositModal);
            elements.closeModalBtn.addEventListener('click', closeDepositModal);
            elements.cancelDepositBtn.addEventListener('click', closeDepositModal);
            elements.confirmDepositBtn.addEventListener('click', confirmDeposit);
            
            elements.cryptoOptions.forEach(option => {
                option.addEventListener('click', () => {
                    elements.cryptoOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    gameState.selectedCrypto = option.dataset.crypto;
                });
            });
            
            elements.quickAmounts.forEach(amount => {
                amount.addEventListener('click', () => {
                    elements.depositAmountInput.value = amount.dataset.amount;
                });
            });
            
            // 大路圖控制
            elements.clearRoadBtn.addEventListener('click', clearBigRoad);
            elements.toggleRoadBtn.addEventListener('click', toggleRoadType);
            
            // 遊戲控制
            elements.dealBtn.addEventListener('click', dealCards);
            elements.newRoundBtn.addEventListener('click', newRound);
            
            // 下注控制
            elements.targetButtons.forEach(btn => {
                btn.addEventListener('click', () => selectBetTarget(btn.dataset.target));
            });
            
            elements.amountButtons.forEach(btn => {
                btn.addEventListener('click', () => addToBet(parseFloat(btn.dataset.amount)));
            });
            
            elements.setCustomAmountBtn.addEventListener('click', () => {
                const amount = parseFloat(elements.customAmountInput.value);
                if (amount > 0) {
                    setBetAmount(amount);
                }
            });
            
            elements.clearBetBtn.addEventListener('click', clearBet);
            elements.placeBetBtn.addEventListener('click', placeBet);
            
            // 金額輸入
            elements.customAmountInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const amount = parseFloat(elements.customAmountInput.value);
                    if (amount > 0) {
                        setBetAmount(amount);
                    }
                }
            });
        }

        // 音效控制
        function playSound(sound) {
            if (!gameState.soundEnabled) return;
            
            try {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('音效播放失敗:', e));
            } catch (e) {
                console.log('音效錯誤:', e);
            }
        }

        function toggleMusic() {
            gameState.musicEnabled = !gameState.musicEnabled;
            elements.musicBtn.classList.toggle('active');
            
            if (gameState.musicEnabled) {
                audioElements.backgroundMusic.play().catch(e => console.log('音樂播放失敗:', e));
            } else {
                audioElements.backgroundMusic.pause();
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            elements.soundBtn.classList.toggle('active');
        }

        // 存款相關功能
        function openDepositModal() {
            elements.depositModal.classList.add('active');
            elements.depositAmountInput.value = '';
        }

        function closeDepositModal() {
            elements.depositModal.classList.remove('active');
        }

        function confirmDeposit() {
            const amount = parseFloat(elements.depositAmountInput.value);
            
            if (!amount || amount <= 0) {
                alert('請輸入有效的存款金額');
                return;
            }
            
            // 模擬存款成功
            const exchangeRates = {
                'BTC': 65000,
                'ETH': 3500,
                'USDT': 1
            };
            
            const usdtAmount = amount * exchangeRates[gameState.selectedCrypto];
            gameState.balance += usdtAmount;
            
            // 播放存款音效
            playSound(audioElements.depositSound);
            
            // 添加存款紀錄
            addTransaction('存款', `存入 ${amount} ${gameState.selectedCrypto}`, usdtAmount, true);
            
            // 更新UI
            updateUI();
            closeDepositModal();
            
            // 顯示成功訊息
            elements.resultText.textContent = `存款成功！存入 ${usdtAmount.toLocaleString()} USDT`;
            elements.resultText.style.color = 'var(--primary-color)';
            
            setTimeout(() => {
                if (!gameState.isBetPlaced) {
                    elements.resultText.textContent = '請選擇下注目標和金額';
                    elements.resultText.style.color = 'var(--text-color)';
                }
            }, 3000);
        }

        // 下注相關功能
        function selectBetTarget(target) {
            if (gameState.isGameActive) return;
            
            elements.targetButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-target="${target}"]`).classList.add('active');
            
            gameState.currentBetTarget = target;
            
            let targetName = '';
            switch(target) {
                case 'player': targetName = '玩家'; break;
                case 'banker': targetName = '莊家'; break;
                case 'tie': targetName = '和局'; break;
            }
            
            elements.betTargetLabel.textContent = `下注目標: ${targetName}`;
            elements.betTargetLabel.style.color = getTargetColor(target);
            
            playSound(audioElements.chipSound);
        }

        function addToBet(amount) {
            if (gameState.isGameActive) return;
            
            const newAmount = gameState.currentBet + amount;
            
            if (newAmount > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.currentBet = newAmount;
            updateBetUI();
            
            // 更新按鈕狀態
            elements.amountButtons.forEach(btn => {
                btn.classList.remove('active');
                if (parseFloat(btn.dataset.amount) === amount) {
                    btn.classList.add('active');
                }
            });
            
            playSound(audioElements.chipSound);
        }

        function setBetAmount(amount) {
            if (gameState.isGameActive) return;
            
            if (amount > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.currentBet = amount;
            updateBetUI();
            
            // 清除快速按鈕的選中狀態
            elements.amountButtons.forEach(btn => btn.classList.remove('active'));
            
            playSound(audioElements.chipSound);
        }

        function clearBet() {
            if (gameState.isGameActive) return;
            
            gameState.currentBet = 0;
            gameState.currentBetTarget = null;
            gameState.isBetPlaced = false;
            
            elements.targetButtons.forEach(btn => btn.classList.remove('active'));
            elements.amountButtons.forEach(btn => btn.classList.remove('active'));
            elements.customAmountInput.value = '';
            
            updateBetUI();
            elements.resultText.textContent = '請下注後開始遊戲';
            elements.resultText.style.color = 'var(--text-color)';
            
            playSound(audioElements.chipSound);
        }

        function placeBet() {
            if (gameState.isGameActive) {
                alert('遊戲進行中，無法下注！');
                return;
            }
            
            if (gameState.currentBet <= 0) {
                alert('請選擇下注金額！');
                return;
            }
            
            if (!gameState.currentBetTarget) {
                alert('請選擇下注目標！');
                return;
            }
            
            if (gameState.currentBet > gameState.balance) {
                alert('餘額不足！');
                return;
            }
            
            gameState.isBetPlaced = true;
            gameState.balance -= gameState.currentBet;
            
            updateUI();
            
            elements.resultText.textContent = '下注成功！點擊"發牌"開始遊戲';
            elements.resultText.style.color = 'var(--primary-color)';
            
            // 禁用下注按鈕
            elements.placeBetBtn.disabled = true;
            elements.clearBetBtn.disabled = true;
            
            playSound(audioElements.chipSound);
        }

        // 卡片相關函數
        function shuffleDeck() {
            // Fisher-Yates 洗牌算法
            for (let i = currentDeck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
            }
            deckIndex = 0;
        }

        function getNextCard() {
            if (deckIndex >= currentDeck.length) {
                shuffleDeck();
            }
            return currentDeck[deckIndex++];
        }

        function getCardValue(rank) {
            switch(rank) {
                case 'A': return 1;
                case '2': return 2;
                case '3': return 3;
                case '4': return 4;
                case '5': return 5;
                case '6': return 6;
                case '7': return 7;
                case '8': return 8;
                case '9': return 9;
                case '10': 
                case 'J': 
                case 'Q': 
                case 'K': return 0;
                default: return 0;
            }
        }

        function calculatePoints(cards) {
            let total = 0;
            cards.forEach(card => {
                if (card) {
                    total += card.value;
                }
            });
            return total % 10;
        }

        function getCardColor(suit) {
            return suit === '♥' || suit === '♦' ? 'red' : 'black';
        }

        function getCardDisplay(card) {
            return card ? `${card.rank}${card.suit}` : '';
        }

        // 遊戲流程函數
        async function dealCards() {
            if (!gameState.isBetPlaced) {
                alert('請先下注！');
                return;
            }
            
            if (gameState.isGameActive) {
                alert('遊戲正在進行中！');
                return;
            }
            
            gameState.isGameActive = true;
            elements.dealBtn.disabled = true;
            elements.newRoundBtn.disabled = true;
            
            // 重置卡片顯示
            resetCardDisplay();
            
            // 洗牌（如果需要）
            if (deckIndex > currentDeck.length - 10) {
                shuffleDeck();
            }
            
            // 初始化手牌
            gameState.playerCards = [null, null, null];
            gameState.bankerCards = [null, null, null];
            
            // 發前兩張牌
            await dealInitialCards();
            
            // 計算點數並決定是否補牌
            await determineThirdCards();
            
            // 計算最終結果
            await calculateResult();
            
            gameState.isGameActive = false;
            gameState.isBetPlaced = false;
            
            // 啟用按鈕
            elements.dealBtn.disabled = false;
            elements.newRoundBtn.disabled = false;
            elements.placeBetBtn.disabled = false;
            elements.clearBetBtn.disabled = false;
        }

        function newRound() {
            if (gameState.isGameActive) {
                alert('遊戲進行中，無法開始新局！');
                return;
            }
            
            clearBet();
            resetCardDisplay();
            
            gameState.playerCards = [null, null, null];
            gameState.bankerCards = [null, null, null];
            gameState.playerPoints = 0;
            gameState.bankerPoints = 0;
            gameState.gameResult = null;
            
            elements.playerPointsElement.textContent = '0';
            elements.bankerPointsElement.textContent = '0';
            
            elements.resultText.textContent = gameState.balance === 0 ? '請先存款以開始遊戲' : '請下注後開始遊戲';
            elements.resultText.style.color = gameState.balance === 0 ? 'var(--warning-color)' : 'var(--text-color)';
            
            elements.playerSide.classList.remove('active');
            elements.bankerSide.classList.remove('active');
            elements.playerSide.classList.remove('winning-animation');
            elements.bankerSide.classList.remove('winning-animation');
        }

        async function dealInitialCards() {
            playSound(audioElements.dealSound);
            
            // 玩家第一張牌
            gameState.playerCards[0] = getNextCard();
            await revealCard('player', 0, gameState.playerCards[0]);
            
            // 莊家第一張牌
            gameState.bankerCards[0] = getNextCard();
            await revealCard('banker', 0, gameState.bankerCards[0]);
            
            playSound(audioElements.dealSound);
            
            // 玩家第二張牌
            gameState.playerCards[1] = getNextCard();
            await revealCard('player', 1, gameState.playerCards[1]);
            
            // 莊家第二張牌
            gameState.bankerCards[1] = getNextCard();
            await revealCard('banker', 1, gameState.bankerCards[1]);
            
            // 計算前兩張點數
            gameState.playerPoints = calculatePoints([gameState.playerCards[0], gameState.playerCards[1]]);
            gameState.bankerPoints = calculatePoints([gameState.bankerCards[0], gameState.bankerCards[1]]);
            
            elements.playerPointsElement.textContent = gameState.playerPoints;
            elements.bankerPointsElement.textContent = gameState.bankerPoints;
        }

        async function determineThirdCards() {
            // 玩家補牌規則
            const playerFirstTwo = calculatePoints([gameState.playerCards[0], gameState.playerCards[1]]);
            const bankerFirstTwo = calculatePoints([gameState.bankerCards[0], gameState.bankerCards[1]]);
            
            // 玩家補牌規則
            if (playerFirstTwo <= 5) {
                // 玩家補牌
                gameState.playerCards[2] = getNextCard();
                await new Promise(resolve => setTimeout(resolve, 500));
                await revealCard('player', 2, gameState.playerCards[2]);
            }
            
            // 莊家補牌規則（標準百家樂規則）
            let bankerDrawsThird = false;
            const playerThirdCard = gameState.playerCards[2];
            
            if (bankerFirstTwo <= 2) {
                bankerDrawsThird = true;
            } else if (bankerFirstTwo === 3) {
                if (playerThirdCard && playerThirdCard.value !== 8) {
                    bankerDrawsThird = true;
                }
            } else if (bankerFirstTwo === 4) {
                if (playerThirdCard && playerThirdCard.value >= 2 && playerThirdCard.value <= 7) {
                    bankerDrawsThird = true;
                }
            } else if (bankerFirstTwo === 5) {
                if (playerThirdCard && playerThirdCard.value >= 4 && playerThirdCard.value <= 7) {
                    bankerDrawsThird = true;
                }
            } else if (bankerFirstTwo === 6) {
                if (playerThirdCard && (playerThirdCard.value === 6 || playerThirdCard.value === 7)) {
                    bankerDrawsThird = true;
                }
            }
            // bankerFirstTwo >= 7 不補牌
            
            if (bankerDrawsThird) {
                gameState.bankerCards[2] = getNextCard();
                await new Promise(resolve => setTimeout(resolve, 500));
                await revealCard('banker', 2, gameState.bankerCards[2]);
            }
            
            // 重新計算點數
            gameState.playerPoints = calculatePoints(gameState.playerCards.filter(card => card !== null));
            gameState.bankerPoints = calculatePoints(gameState.bankerCards.filter(card => card !== null));
            
            elements.playerPointsElement.textContent = gameState.playerPoints;
            elements.bankerPointsElement.textContent = gameState.bankerPoints;
        }

        async function calculateResult() {
            // 判斷勝負
            let result = '';
            
            if (gameState.playerPoints > gameState.bankerPoints) {
                result = 'player';
            } else if (gameState.playerPoints < gameState.bankerPoints) {
                result = 'banker';
            } else {
                result = 'tie';
            }
            
            gameState.gameResult = result;
            
            // 計算盈利
            let profit = 0;
            let netProfit = 0;
            
            if (result === gameState.currentBetTarget) {
                switch(result) {
                    case 'player':
                    case 'banker':
                        profit = gameState.currentBet * 1.95;
                        break;
                    case 'tie':
                        profit = gameState.currentBet * 8.00;
                        break;
                }
                netProfit = profit - gameState.currentBet;
            } else if (result === 'tie') {
                // 和局退回下注金額
                profit = gameState.currentBet;
                netProfit = 0;
            } else {
                profit = 0;
                netProfit = -gameState.currentBet;
            }
            
            // 更新餘額
            gameState.balance += profit;
            gameState.totalProfit += netProfit;
            
            // 更新統計
            gameState.totalRounds++;
            if (result === 'player') gameState.playerWins++;
            else if (result === 'banker') gameState.bankerWins++;
            else gameState.tieGames++;
            
            // 更新大路圖
            updateBigRoad(result);
            
            // 添加歷史紀錄
            addGameHistory(result, profit, netProfit);
            
            // 顯示結果
            displayResult(result, netProfit);
            
            // 播放音效
            if (netProfit > 0) {
                playSound(audioElements.winSound);
            } else if (netProfit < 0) {
                playSound(audioElements.loseSound);
            }
            
            // 更新UI
            updateUI();
        }

        // UI更新函數
        function updateUI() {
            // 更新餘額
            elements.totalBalance.textContent = gameState.balance.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            // 更新統計
            elements.totalRoundsElement.textContent = gameState.totalRounds;
            elements.playerWinsElement.textContent = gameState.playerWins;
            elements.bankerWinsElement.textContent = gameState.bankerWins;
            elements.tieGamesElement.textContent = gameState.tieGames;
            
            const winRate = gameState.totalRounds > 0 ? 
                Math.round(((gameState.currentBetTarget === 'player' ? gameState.playerWins : 
                           gameState.currentBetTarget === 'banker' ? gameState.bankerWins : 
                           gameState.tieGames) / gameState.totalRounds) * 100) : 0;
            elements.winRateElement.textContent = `${winRate}%`;
            
            elements.totalProfitElement.textContent = gameState.totalProfit.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            elements.totalProfitElement.style.color = gameState.totalProfit >= 0 ? 
                'var(--primary-color)' : 'var(--danger-color)';
            
            // 更新按鈕狀態
            const canPlay = gameState.balance > 0 && gameState.isBetPlaced;
            elements.dealBtn.disabled = !canPlay || gameState.isGameActive;
        }

        function updateBetUI() {
            elements.betAmountValue.textContent = gameState.currentBet.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function resetCardDisplay() {
            const playerCards = elements.playerCardsContainer.children;
            const bankerCards = elements.bankerCardsContainer.children;
            
            for (let i = 0; i < 3; i++) {
                // 重置玩家卡片
                playerCards[i].className = 'card placeholder';
                playerCards[i].children[0].textContent = '';
                playerCards[i].children[0].className = 'card-front';
                playerCards[i].children[1].innerHTML = i === 2 ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-question"></i>';
                playerCards[i].children[1].className = 'card-back';
                playerCards[i].style.opacity = i === 2 ? '0.5' : '1';
                
                // 重置莊家卡片
                bankerCards[i].className = 'card placeholder';
                bankerCards[i].children[0].textContent = '';
                bankerCards[i].children[0].className = 'card-front';
                bankerCards[i].children[1].innerHTML = i === 2 ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-question"></i>';
                bankerCards[i].children[1].className = 'card-back';
                bankerCards[i].style.opacity = i === 2 ? '0.5' : '1';
            }
        }

        async function revealCard(side, index, card) {
            const container = side === 'player' ? elements.playerCardsContainer : elements.bankerCardsContainer;
            const cardElement = container.children[index];
            
            // 播放發牌音效
            playSound(audioElements.cardSound);
            
            // 翻牌動畫
            cardElement.classList.remove('placeholder');
            cardElement.classList.add('card-dealing');
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 翻轉卡片
            cardElement.classList.add('flipped');
            
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // 顯示卡片值
            const color = getCardColor(card.suit);
            cardElement.children[0].textContent = getCardDisplay(card);
            cardElement.children[0].classList.add(color);
            
            // 特殊卡片樣式
            if (card.rank === 'A' || card.rank === 'K' || card.rank === 'Q' || card.rank === 'J') {
                cardElement.classList.add('special-card');
            }
            
            await new Promise(resolve => setTimeout(resolve, 200));
        }

        function displayResult(result, netProfit) {
            let resultText = '';
            let resultColor = '';
            
            switch(result) {
                case 'player':
                    resultText = '玩家勝！';
                    resultColor = 'var(--player-color)';
                    elements.playerSide.classList.add('winning-animation');
                    break;
                case 'banker':
                    resultText = '莊家勝！';
                    resultColor = 'var(--banker-color)';
                    elements.bankerSide.classList.add('winning-animation');
                    break;
                case 'tie':
                    resultText = '和局！';
                    resultColor = 'var(--tie-color)';
                    break;
            }
            
            if (netProfit > 0) {
                resultText += ` 盈利: +${netProfit.toFixed(2)} USDT`;
            } else if (netProfit < 0) {
                resultText += ` 虧損: ${netProfit.toFixed(2)} USDT`;
            } else {
                resultText += ' 平局';
            }
            
            elements.resultText.textContent = resultText;
            elements.resultText.style.color = resultColor;
        }

        // 大路圖功能
        function initializeBigRoad() {
            elements.roadTable.innerHTML = '';
            
            // 創建6行 x 40列的大路圖
            for (let row = 0; row < 6; row++) {
                for (let col = 0; col < 40; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'road-cell empty-road';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    elements.roadTable.appendChild(cell);
                }
            }
        }

        function updateBigRoad(result) {
            const roadData = gameState.bigRoad;
            roadData.push(result);
            
            // 只保留最近240個結果（6行 x 40列）
            if (roadData.length > 240) {
                roadData.splice(0, roadData.length - 240);
            }
            
            // 重新繪製大路圖
            initializeBigRoad();
            
            // 標準大路圖算法
            let currentRow = 0;
            let currentCol = 0;
            let prevResult = null;
            
            // 處理和局
            const processedData = [];
            let dragonCount = 1;
            
            for (let i = 0; i < roadData.length; i++) {
                const currentResult = roadData[i];
                
                if (currentResult === 'tie') {
                    // 和局在最後一個結果上顯示
                    if (processedData.length > 0) {
                        const lastEntry = processedData[processedData.length - 1];
                        if (!lastEntry.tie) {
                            lastEntry.tie = true;
                        }
                    }
                    continue;
                }
                
                if (prevResult === null || currentResult !== prevResult) {
                    // 新的一列
                    currentCol++;
                    if (currentCol >= 40) {
                        currentCol = 0;
                        currentRow++;
                        if (currentRow >= 6) {
                            // 滾動到新行
                            currentRow = 0;
                            // 清除第一行
                            gameState.bigRoad.splice(0, 40);
                            return updateBigRoad(result); // 重新計算
                        }
                    }
                    dragonCount = 1;
                } else {
                    // 同一列，向下移動
                    currentRow++;
                    if (currentRow >= 6) {
                        // 滾動到新列
                        currentRow = 0;
                        currentCol++;
                        if (currentCol >= 40) {
                            currentCol = 0;
                            // 清除第一行
                            gameState.bigRoad.splice(0, 40);
                            return updateBigRoad(result); // 重新計算
                        }
                    }
                    dragonCount++;
                }
                
                processedData.push({
                    result: currentResult,
                    row: currentRow,
                    col: currentCol,
                    dragon: dragonCount,
                    tie: false
                });
                
                prevResult = currentResult;
            }
            
            // 繪製大路圖
            processedData.forEach(entry => {
                const cellIndex = entry.row * 40 + entry.col;
                if (cellIndex < elements.roadTable.children.length) {
                    const cell = elements.roadTable.children[cellIndex];
                    cell.className = 'road-cell road-entry';
                    
                    if (entry.result === 'player') {
                        cell.classList.add('player-road');
                        cell.textContent = 'P';
                    } else if (entry.result === 'banker') {
                        cell.classList.add('banker-road');
                        cell.textContent = 'B';
                    }
                    
                    // 龍寶顯示
                    if (entry.dragon > 1) {
                        const dragonSpan = document.createElement('span');
                        dragonSpan.className = 'road-dragon';
                        dragonSpan.textContent = entry.dragon;
                        cell.appendChild(dragonSpan);
                    }
                    
                    // 和局標記
                    if (entry.tie) {
                        const tieMark = document.createElement('div');
                        tieMark.className = 'tie-road';
                        tieMark.style.width = '12px';
                        tieMark.style.height = '12px';
                        tieMark.style.position = 'absolute';
                        tieMark.style.top = '6px';
                        tieMark.style.right = '6px';
                        cell.appendChild(tieMark);
                    }
                }
            });
        }

        function clearBigRoad() {
            gameState.bigRoad = [];
            initializeBigRoad();
        }

        function toggleRoadType() {
            gameState.roadType = gameState.roadType === 'big' ? 'bead' : 'big';
            elements.toggleRoadBtn.textContent = gameState.roadType === 'big' ? '珠盤路' : '大路';
            
            // 這裡可以實現切換不同路紙的功能
            // 目前只實現大路
        }

        // 歷史紀錄功能
        function addGameHistory(result, profit, netProfit) {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            const historyItem = {
                round: gameState.totalRounds,
                result: result,
                betTarget: gameState.currentBetTarget,
                betAmount: gameState.currentBet,
                profit: netProfit,
                time: timeString
            };
            
            gameState.gameHistory.unshift(historyItem);
            
            // 更新歷史列表顯示
            updateHistoryList();
        }

        function addTransaction(type, description, amount, isPositive) {
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            const transaction = {
                type: type,
                description: description,
                amount: amount,
                isPositive: isPositive,
                time: timeString
            };
            
            // 添加到遊戲歷史
            const historyItem = {
                round: '存款',
                result: type.toLowerCase(),
                betTarget: description,
                betAmount: 0,
                profit: amount,
                time: timeString
            };
            
            gameState.gameHistory.unshift(historyItem);
            updateHistoryList();
        }

        function updateHistoryList() {
            // 清空歷史列表
            elements.historyList.innerHTML = '';
            
            // 顯示最新10條紀錄
            const recentHistory = gameState.gameHistory.slice(0, 10);
            
            if (recentHistory.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'history-item';
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = 'var(--text-secondary)';
                emptyMessage.style.padding = '30px';
                emptyMessage.textContent = '尚未有交易紀錄';
                elements.historyList.appendChild(emptyMessage);
                return;
            }
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item history-${item.result}`;
                
                let resultText = '';
                switch(item.result) {
                    case 'player': resultText = '玩家勝'; break;
                    case 'banker': resultText = '莊家勝'; break;
                    case 'tie': resultText = '和局'; break;
                    case 'deposit': resultText = '存款'; break;
                }
                
                const profit = item.profit;
                const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';
                const profitSign = profit >= 0 ? '+' : '';
                
                historyItem.innerHTML = `
                    <div class="history-info">
                        <div class="history-round">${item.round}</div>
                        <div class="history-result">${resultText}</div>
                    </div>
                    <div class="history-amount ${profitClass}">
                        ${profitSign}${profit.toFixed(2)} USDT
                    </div>
                `;
                
                elements.historyList.appendChild(historyItem);
            });
        }

        // 輔助函數
        function getTargetColor(target) {
            switch(target) {
                case 'player': return 'var(--player-color)';
                case 'banker': return 'var(--banker-color)';
                case 'tie': return 'var(--tie-color)';
                default: return 'var(--text-color)';
            }
        }

        // 初始化遊戲
        initializeGame();
    </script>
</body>
</html>
